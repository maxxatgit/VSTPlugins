<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja" >

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
      <meta name="dcterms.date" content="2024-09-28" />
      <title>vst3_dev – Uhhyou Plugins</title>
  <link rel="icon" type="image/svg+xml" href="../img/favicon/favicon.svg">
  <link rel="icon" type="image/png" href="../img/favicon/favicon.svgindex-relative-path=../index.html">
  <style>
    :root {
      --foreground-color: #000000;
      --background-color: #ffffff;
      --link-color: #0000ee;
      --link-visited-color: #551a8b;
      --link-active-color: #ff0000;
      --link-hover-background-color: #ffe590;
      --border-dark-color: #444444;
      --border-color: #888888;
      --border-light-color: #bbbbbb;
      --table-odd-color: #eeeeee;
      --code-inline-color: #705020;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --foreground-color: #dfdfdf;
        --background-color: #202020;
        --link-color: #dfdf2c;
        --link-visited-color: #9fcb76;
        --link-active-color: #20dfdf;
        --link-hover-background-color: #203373;
        --border-dark-color: #acacac;
        --border-color: #797979;
        --border-light-color: #525252;
        --table-odd-color: #2c2c2c;
        --code-inline-color: #8ba3c7;
      }

      img:not(.staySameInDark) {
        filter: invert(0.8745);
      }

      h1::after {
        filter: invert(0.8745);
      }
    }

    body {
      max-width: 704px;
      margin: auto;
      padding: 32px 8px;
      color: var(--foreground-color);
      background-color: var(--background-color);
    }

    img {
      max-width: 100%;
    }

    video {
      max-width: 100%;
    }

    details.list>summary {
      line-height: 3em;
    }

    kbd {
      font-family: inherit;
      border-style: outset;
      border-width: 1px 2px 2px 1px;
      border-radius: 2px;
      padding: 2px 4px;
      margin: 2px;
      line-height: calc(1em + 16px);
    }

    a {
      text-decoration: none;
    }

    a:hover {
      background-color: var(--link-hover-background-color);
    }

    :link {
      color: var(--link-color);
    }

    :visited {
      color: var(--link-visited-color);
    }

    :link:active,
    :visited:active {
      color: var(--link-active-color);
    }

    .header-anchor:hover {
      color: var(--link-color);
    }

    :is(h1, h2, h3, h4, h5, h6)>:is(a:link, a:visited, a:link:active, a:visited:active) {
      color: var(--foreground-color);
    }

    h1 {
      padding-left: 8px;
      vertical-align: middle;
    }

    h1::after {
      display: inline-block;
      background-image: url('../img/favicon/favicon.svg');
      content: "";
      vertical-align: middle;
      background-size: 128px 128px;
      width: 128px;
      height: 128px;
      margin-left: 1rem;
    }

    @media all and (max-width: 704px) {
      h1::after {
        background-size: 2em 2em;
        width: 2em;
        height: 2em;
      }
    }

    h2 {
      border-bottom: 1px solid var(--border-dark-color);
    }

    h3 {
      text-decoration: underline var(--border-light-color);
      text-underline-offset: 0.5rem;
    }

    h4 {
      text-decoration: underline dashed var(--border-light-color);
      text-underline-offset: 0.5rem;
      margin-bottom: 0.5em;
    }

    h5 {
      margin-bottom: 0.5em;
    }

    h6 {
      margin-bottom: 0.5em;
    }

    table {
      border-spacing: 0px;
      border-collapse: separate;
      border-left: 1px solid var(--border-color);
      border-right: 1px solid var(--border-color);
      border-top: 1px solid var(--border-color);
      border-bottom: hidden;
    }

    tr:nth-child(odd) {
      background: var(--table-odd-color);
    }

    tr:nth-child(even) {
      background: var(--background-color);
    }

    th {
      height: 2em;
      padding: 4px 1em 4px 1em;
      background: var(--background-color);
      border-bottom: 1px solid var(--border-color);
    }

    th:not(:first-child) {
      border-left: 1px solid var(--border-color);
    }

    td {
      height: 1.5em;
      padding: 4px 1em 4px 1em;
      border-bottom: 1px solid var(--border-color);
    }

    td:not(:first-child) {
      border-left: 1px solid var(--border-color);
    }

    dl {
      padding-left: 2em;
    }

    dt {
      font-weight: bold;
      border-bottom: 1px dashed var(--foreground-color);
    }

    dd {
      border-left: 1px dotted var(--foreground-color);
      margin-left: 1em;
      margin-bottom: 2em;
      padding-left: 1em;
    }

    audio {
      vertical-align: middle;
    }

    label {
      vertical-align: middle;
    }

    :not(.sourceCode)>pre {
      overflow: auto;
      border: 1px solid var(--border-color);
      padding: 8px;
    }

    div.sourceCode {
      overflow: auto;
      border: 1px solid var(--border-color);
      padding: 8px;
    }

    pre>code.sourceCode>span>a:first-child::before {
      border-right: 1px solid var(--border-color);
      padding-right: 1em;
      margin-right: 1em;
      text-decoration: none;
    }

    :not(pre)>code {
      margin-left: 0.25em;
      margin-right: 0.25em;
      color: var(--code-inline-color);
    }

    li {
      margin: 8px;
    }

    summary:hover {
      background-color: var(--table-odd-color);
    }

    header {
      border-bottom: 1px var(--border-color) solid;
      padding: 0.5em;
      margin-bottom: 1em;
    }

    footer {
      border-top: 1px var(--border-color) solid;
      padding: 0.5em;
      margin-top: 1em;
    }

    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    span.underline {
      text-decoration: underline;
    }

    div.column {
      display: inline-block;
      vertical-align: top;
      width: 50%;
    }
  </style>
      </head>

<body>
    <header>
        <p><a href="../index.html">Back to Index</a></p>
            <p>
      Update: 2024-09-28
    </p>
            <details>
      <summary translate="yes">Table of Contents</summary>
      <nav id="TOC" role="doc-toc">
        <ul>
        <li><a href="#vst-3-の開発" id="toc-vst-3-の開発">VST 3
        の開発</a>
        <ul>
        <li><a href="#ライセンス"
        id="toc-ライセンス">ライセンス</a></li>
        <li><a href="#リソース" id="toc-リソース">リソース</a></li>
        <li><a href="#プラグインホストについて"
        id="toc-プラグインホストについて">プラグインホストについて</a>
        <ul>
        <li><a href="#vst3plugintesthost"
        id="toc-vst3plugintesthost">VST3PluginTestHost</a></li>
        <li><a href="#fl-studio-20.6" id="toc-fl-studio-20.6">FL Studio
        20.6</a></li>
        <li><a href="#reaper-5.980" id="toc-reaper-5.980">Reaper
        5.980</a></li>
        <li><a href="#live-10.1.6" id="toc-live-10.1.6">Live
        10.1.6</a></li>
        </ul></li>
        <li><a href="#開発環境の構築"
        id="toc-開発環境の構築">開発環境の構築</a>
        <ul>
        <li><a href="#開発用ソフトウェアのインストール"
        id="toc-開発用ソフトウェアのインストール">開発用ソフトウェアのインストール</a>
        <ul>
        <li><a href="#windows-10" id="toc-windows-10">Windows
        10</a></li>
        <li><a href="#linux" id="toc-linux">Linux</a></li>
        <li><a href="#vs-code-のエクステンション"
        id="toc-vs-code-のエクステンション">VS Code
        のエクステンション</a></li>
        <li><a href="#ripgrep" id="toc-ripgrep">ripgrep</a></li>
        </ul></li>
        </ul></li>
        <li><a href="#ビルド" id="toc-ビルド">ビルド</a>
        <ul>
        <li><a href="#windows-10-1" id="toc-windows-10-1">Windows 10</a>
        <ul>
        <li><a href="#リリースビルド"
        id="toc-リリースビルド">リリースビルド</a></li>
        <li><a href="#bit-x86-ビルド" id="toc-bit-x86-ビルド">32bit
        (x86) ビルド</a></li>
        <li><a href="#デプロイ" id="toc-デプロイ">デプロイ</a></li>
        </ul></li>
        <li><a href="#linux-1" id="toc-linux-1">Linux</a></li>
        <li><a href="#cmake-のオプション"
        id="toc-cmake-のオプション">CMake のオプション</a>
        <ul>
        <li><a href="#サンプルプロジェクトのビルドを無効にする"
        id="toc-サンプルプロジェクトのビルドを無効にする">サンプルプロジェクトのビルドを無効にする</a></li>
        <li><a href="#コンパイラオプションの変更"
        id="toc-コンパイラオプションの変更">コンパイラオプションの変更</a></li>
        </ul></li>
        </ul></li>
        <li><a href="#テスト" id="toc-テスト">テスト</a>
        <ul>
        <li><a href="#自動テスト"
        id="toc-自動テスト">自動テスト</a></li>
        <li><a href="#vst3plugintesthost-1"
        id="toc-vst3plugintesthost-1">VST3PluginTestHost</a></li>
        <li><a href="#reaper" id="toc-reaper">REAPER</a></li>
        </ul></li>
        <li><a href="#vst3-プラグインの大まかな仕組み"
        id="toc-vst3-プラグインの大まかな仕組み">VST3
        プラグインの大まかな仕組み</a></li>
        <li><a href="#デバッグ" id="toc-デバッグ">デバッグ</a>
        <ul>
        <li><a href="#ブレークポイント"
        id="toc-ブレークポイント">ブレークポイント</a></li>
        <li><a href="#プリント" id="toc-プリント">プリント</a></li>
        </ul></li>
        <li><a href="#helloworld-プラグインを何とかする"
        id="toc-helloworld-プラグインを何とかする">helloworld
        プラグインを何とかする</a>
        <ul>
        <li><a href="#ファイルの配置の変更"
        id="toc-ファイルの配置の変更">ファイルの配置の変更</a></li>
        <li><a href="#名前やfuidの設定"
        id="toc-名前やfuidの設定">名前やFUIDの設定</a></li>
        <li><a href="#音を出す" id="toc-音を出す">音を出す</a></li>
        <li><a href="#パラメータの追加"
        id="toc-パラメータの追加">パラメータの追加</a>
        <ul>
        <li><a href="#vst3-のパラメータ" id="toc-vst3-のパラメータ">VST3
        のパラメータ</a></li>
        <li><a href="#パラメータ用のヘッダとソースの作成"
        id="toc-パラメータ用のヘッダとソースの作成">パラメータ用のヘッダとソースの作成</a></li>
        </ul></li>
        <li><a href="#hello-gui" id="toc-hello-gui">Hello GUI</a></li>
        <li><a href="#リファクタリング"
        id="toc-リファクタリング">リファクタリング</a></li>
        </ul></li>
        <li><a href="#ポインタの扱いについて"
        id="toc-ポインタの扱いについて">ポインタの扱いについて</a></li>
        <li><a href="#gui" id="toc-gui">GUI</a>
        <ul>
        <li><a href="#vst3-inline-ui-editor-を使った-gui-の作成"
        id="toc-vst3-inline-ui-editor-を使った-gui-の作成">VST3 inline
        UI editor を使った GUI の作成</a>
        <ul>
        <li><a href="#オプションメニュー-コンボボックス-の追加"
        id="toc-オプションメニュー-コンボボックス-の追加">オプションメニュー
        (コンボボックス) の追加</a></li>
        <li><a href="#ワークアラウンド"
        id="toc-ワークアラウンド">ワークアラウンド</a></li>
        <li><a href="#カスタムビューの追加"
        id="toc-カスタムビューの追加">カスタムビューの追加</a></li>
        <li><a href="#パラメータの連動"
        id="toc-パラメータの連動">パラメータの連動</a></li>
        </ul></li>
        <li><a href="#コードでgui" id="toc-コードでgui">コードでGUI</a>
        <ul>
        <li><a href="#カスタムフォント"
        id="toc-カスタムフォント">カスタムフォント</a></li>
        <li><a href="#ホストのオートメーションに応じて表示を更新"
        id="toc-ホストのオートメーションに応じて表示を更新">ホストのオートメーションに応じて表示を更新</a></li>
        <li><a href="#リフレッシュレートの設定"
        id="toc-リフレッシュレートの設定">リフレッシュレートの設定</a></li>
        <li><a href="#キーボードイベントの受け取り"
        id="toc-キーボードイベントの受け取り">キーボードイベントの受け取り</a></li>
        <li><a
        href="#カスタムビューの実装と関連するコントロールの表示の変更"
        id="toc-カスタムビューの実装と関連するコントロールの表示の変更">カスタムビューの実装と関連するコントロールの表示の変更</a></li>
        <li><a href="#スプラッシュスクリーンの追加"
        id="toc-スプラッシュスクリーンの追加">スプラッシュスクリーンの追加</a></li>
        <li><a href="#ホストが提供するコンテキストメニューの追加"
        id="toc-ホストが提供するコンテキストメニューの追加">ホストが提供するコンテキストメニューの追加</a></li>
        <li><a href="#linux-で-vstgui-を利用"
        id="toc-linux-で-vstgui-を利用">Linux で VSTGUI を利用</a></li>
        <li><a href="#コンテキストメニューにズーム機能を追加"
        id="toc-コンテキストメニューにズーム機能を追加">コンテキストメニューにズーム機能を追加</a></li>
        </ul></li>
        </ul></li>
        </ul></li>
        </ul>
      </nav>
    </details>
      </header>
  <h1 id="vst-3-の開発"><a href="#vst-3-の開発" class="header-anchor"
  aria-hidden="true">VST 3 の開発</a></h1>
  <p>VST 3 の開発についてまとめました。何かあれば <a
  href="https://github.com/ryukau/VSTPlugins">GitHub のリポジトリ</a>に
  issue を作ってもらえれば対応します。</p>
  <p>初版を書いたときは VST 3 SDK 3.6.13 と VSTGUI 4.8
  を使っていました。最後に動作を確認したバージョンは VST 3 SDK 3.6.14 と
  VSTGUI 4.9 です。</p>
  <p>最後に編集したときのバージョンは VST 3 SDK 3.7.5 と VSTGUI 4.11
  です。ところどころ廃止 (depricated)
  になったメソッドなどが紛れているかもしれないので注意してください。そのままコピペすることは推奨しません。</p>
  <p>最新版の SDK は Steinberg のページからダウンロードできます。</p>
  <ul>
  <li><a
  href="https://www.steinberg.net/en/company/developers.html">Developers
  | Steinberg</a></li>
  </ul>
  <p>GitHub のリポジトリからクローンすることもできます。</p>
  <ul>
  <li><a href="https://github.com/steinbergmedia/vst3sdk">GitHub -
  steinbergmedia/vst3sdk: VST 3 Plug-In SDK</a></li>
  </ul>
  <p>この文章では Steinberg のページからダウンロードできる SDK
  を使います。 GitHub のリポジトリには helloworld や VST3PluginTestHost
  が含まれていないからです。 <code>my_plugins</code>
  から始まるパスは開発中のプラグイン内のパスを表しています。それ以外のパスは特に断りがないときは
  <code>VST3_SDK</code> 以下の部分だけを書いています。</p>
  <h2 id="ライセンス"><a href="#ライセンス" class="header-anchor"
  aria-hidden="true">ライセンス</a></h2>
  <p><code>VST3_SDK</code> 以下の各ディレクトリのライセンスです。</p>
  <table>
  <thead>
  <tr class="header">
  <th>ディレクトリ</th>
  <th>ライセンス</th>
  </tr>
  </thead>
  <tbody>
  <tr class="odd">
  <td>base</td>
  <td>BSD 3-Clause License</td>
  </tr>
  <tr class="even">
  <td>cmake</td>
  <td>Proprietary Steinberg VST 3 License あるいは GPLv3</td>
  </tr>
  <tr class="odd">
  <td>doc</td>
  <td>Proprietary Steinberg VST 3 License あるいは GPLv3</td>
  </tr>
  <tr class="even">
  <td>pluginterfaces</td>
  <td>Proprietary Steinberg VST 3 License あるいは GPLv3</td>
  </tr>
  <tr class="odd">
  <td>public.sdk</td>
  <td>BSD 3-Clause License</td>
  </tr>
  <tr class="even">
  <td>vstgui4</td>
  <td>BSD 3-Clause License</td>
  </tr>
  </tbody>
  </table>
  <p>Steinberg にメールを送信して確認したところ、 Proprietary Steinberg
  VST 3 License あるいは GPLv3 のどちらを選択するかに関わらず
  <code>VST3_License_Agreement.pdf</code> に署名して Steinberg
  に送信する必要があります。</p>
  <p>選択したライセンスに関わらず VST compatible logo
  の表示が義務付けられています。 VST compatible logo は
  <code>doc/artwork</code> に入っています。また VST compatible logo
  の正しい表示方法が <code>VST3_Usage_Guidelines.pdf</code>
  に書いてあります。</p>
  <p>ソースコードを公開するときは GPLv3
  で配布することができます。利用したライブラリのライセンスはバイナリの配布時に同梱する必要があります。ユーザマニュアルや
  GUI
  のクレジット画面でも利用したライセンスを参照できるようにすることが推奨されています。</p>
  <p>ソースコードを公開しないときは Proprietary Steinberg VST 3 License
  と BSD 3-Clause License に従って配布することになります。 Proprietary
  Steinberg VST 3 License の詳細は
  <code>VST3_License_Agreement.pdf</code> に書いてあります。</p>
  <ul>
  <li><a
  href="https://sdk.steinberg.net/viewtopic.php?f=4&amp;t=286&amp;sid=5da7b39b81a3259e03063b18bce97010">VST
  3 SDK Licensing FAQ - sdk.steinberg.net</a></li>
  <li><a href="https://www.gnu.org/licenses/gpl-3.0.en.html">The GNU
  General Public License v3.0 - GNU Project - Free Software
  Foundation</a></li>
  <li><a href="https://opensource.org/licenses/BSD-3-Clause">The
  3-Clause BSD License | Open Source Initiative</a></li>
  <li><a
  href="https://opensource.stackexchange.com/questions/7575/bsd-3-clause-where-to-place-license-for-binary-installation">binaries
  - BSD 3-Clause: where to place license for binary installation? - Open
  Source Stack Exchange</a></li>
  </ul>
  <h2 id="リソース"><a href="#リソース" class="header-anchor"
  aria-hidden="true">リソース</a></h2>
  <p>VST 3 SDK
  の主な学習リソースは同梱されているサンプルプラグインのコードになります。サンプルプラグインは
  <code>public.sdk/samples/vst</code> に入っています。とりあえず
  <code>again</code> と <code>note_expression_synth</code>
  を押さえておけば何とかなります。</p>
  <p>VST 3 SDK
  に付属してくるドキュメンテーションはダウンロードしたディレクトリの
  <code>doc/index.html</code> から開けます。次のリンクは GitHub
  でホストされているドキュメンテーションです。</p>
  <ul>
  <li><a href="https://steinbergmedia.github.io/vst3_doc/">Steinberg
  Plug-in Interfaces Documentation</a></li>
  </ul>
  <p>VSTGUI4 のドキュメンテーションが 404
  ですが、次のリンクが使えます。</p>
  <ul>
  <li><a
  href="https://steinbergmedia.github.io/vst3_doc/vstgui/html/">VSTGUI:
  Main Page</a></li>
  </ul>
  <p>ドキュメンテーション内をまとめて検索する方法が提供されていません。検索窓からクラスなどを探すときはトップページからのリンク先ごとに検索結果が異なるので注意してください。</p>
  <p>開発者フォーラムもあります。</p>
  <ul>
  <li><a href="https://sdk.steinberg.net/index.php">sdk.steinberg.net -
  Index page</a></li>
  </ul>
  <p>外部のリソースとしてはうつぼかずらさんによる<a
  href="https://www.utsbox.com/">C++でVST作り</a>がとても参考になります。</p>
  <ul>
  <li><a href="https://www.utsbox.com/">C++でVST作り</a></li>
  </ul>
  <h2 id="プラグインホストについて"><a href="#プラグインホストについて"
  class="header-anchor"
  aria-hidden="true">プラグインホストについて</a></h2>
  <p>VST 3
  はホストによっては実装が中途半端なようです。ここではホストごとの特徴的な挙動や不具合をまとめています。</p>
  <h3 id="vst3plugintesthost"><a href="#vst3plugintesthost"
  class="header-anchor" aria-hidden="true">VST3PluginTestHost</a></h3>
  <ul>
  <li>プラグイン起動直後に <code>Vst::AudioEffect</code> の
  <code>process</code> が <code>setActive</code>
  よりも先に呼ばれることがある。</li>
  </ul>
  <h3 id="fl-studio-20.6"><a href="#fl-studio-20.6"
  class="header-anchor" aria-hidden="true">FL Studio 20.6</a></h3>
  <ul>
  <li>GUI のない VST 3 プラグインは何も表示されない。</li>
  <li>VST 3
  プラグインのウィンドウを開いてから別のウィンドウを選択すると、プラグインのウィンドウが真っ黒になる。</li>
  </ul>
  <p>不具合というより仕様ですが、プラグインの GUI
  ウィンドウの大きさを変更できないので VST3Editor の UI
  エディタで編集をするときにワークアラウンドが必要です。</p>
  <ul>
  <li>TODO ワークアラウンドへの参照。</li>
  </ul>
  <h3 id="reaper-5.980"><a href="#reaper-5.980" class="header-anchor"
  aria-hidden="true">Reaper 5.980</a></h3>
  <ul>
  <li>VST3Editor の UI エディタを開こうとするとクラッシュする。</li>
  </ul>
  <h3 id="live-10.1.6"><a href="#live-10.1.6" class="header-anchor"
  aria-hidden="true">Live 10.1.6</a></h3>
  <ul>
  <li>Note ID をサポートしていない。</li>
  </ul>
  <h2 id="開発環境の構築"><a href="#開発環境の構築"
  class="header-anchor" aria-hidden="true">開発環境の構築</a></h2>
  <p>VST 3 SDK を編集してビルドできるように開発環境を構築します。</p>
  <p>ここでは CMake + VS Code + PowerShell を使っています。 Visual
  Studio や Qt Creater などの IDE は使っていません。</p>
  <h3 id="開発用ソフトウェアのインストール"><a
  href="#開発用ソフトウェアのインストール" class="header-anchor"
  aria-hidden="true">開発用ソフトウェアのインストール</a></h3>
  <h4 id="windows-10"><a href="#windows-10" class="header-anchor"
  aria-hidden="true">Windows 10</a></h4>
  <p>次のソフトウェアをインストールします。</p>
  <ul>
  <li><a href="https://visualstudio.microsoft.com/vs/community/">Visual
  Studio Community 2019</a></li>
  <li><a href="https://cmake.org/">CMake</a></li>
  <li><a href="https://code.visualstudio.com/">VS Code</a></li>
  </ul>
  <p>Visual Studio Community 2019 のインストール時には「C++
  によるデスクトップ開発」にチェックが入っていることを確認して、あとはデフォルトにしておきました。</p>
  <h4 id="linux"><a href="#linux" class="header-anchor"
  aria-hidden="true">Linux</a></h4>
  <p>次のリンクに VST 3 SDK
  のビルドに必要なパッケージが書いてあります。</p>
  <ul>
  <li><a href="https://steinbergmedia.github.io/vst3_doc/">Steinberg
  Plug-in Interfaces Documentation</a></li>
  </ul>
  <p>Ubuntu か Mint
  なら上のドキュメンテーションのコマンドをコピペで動きます。</p>
  <p>バグレポートをしていただいた方からの情報によると Debian buster
  でもドキュメンテーションのコマンドでビルド環境が整うようです。ただし
  <code>libxcb-util</code> のバージョンが Ubuntu
  とは異なるため、バイナリの互換性はないようです。</p>
  <ul>
  <li><a href="https://github.com/ryukau/VSTPlugins/issues/3">VST3 GUI
  does not display in Linux · Issue #3 · ryukau/VSTPlugins ·
  GitHub</a></li>
  </ul>
  <p>Fedora 31
  でもビルドできることを確認しました。パッケージの名前が一部異なります。パッケージを探すときは
  <a href="https://rpmfind.net/linux/RPM/index.html">rpmfind.net</a>
  が使えます。</p>
  <h4 id="vs-code-のエクステンション"><a
  href="#vs-code-のエクステンション" class="header-anchor"
  aria-hidden="true">VS Code のエクステンション</a></h4>
  <p>次の VS Code のエクステンションをインストールしました。</p>
  <ul>
  <li>C/C++ (by Microsoft)</li>
  <li>CMake (by twxs)</li>
  <li>PowerShell (by Microsoft)</li>
  <li>XML (by Red Hat)</li>
  <li>Bookmarks (by Alessandro Fragnani)</li>
  </ul>
  <p>XML と Bookmarks は無くても何とかなります。</p>
  <p>XML のプラグインは GUI が記述された uidesc というファイルが XML
  だったのでフォーマットするためにインストールしました。 Red Hat
  のプラグインにしたのは要素の属性ごとに改行するフォーマットオプションがあったからです。
  <a href="https://jdk.java.net/12/">OpenJDK</a>
  が必要なのでインストールには手間がかかります。</p>
  <p>Bookmarks
  はパラメータ追加で複数のファイルを行ったり来たりするときに便利です。</p>
  <h4 id="ripgrep"><a href="#ripgrep" class="header-anchor"
  aria-hidden="true">ripgrep</a></h4>
  <p>ドキュメンテーションなどの検索ツールとして <a
  href="https://github.com/BurntSushi/ripgrep">ripgrep</a>
  をインストールしました。まず <a
  href="https://www.rust-lang.org/">Rust</a> をインストールしてから
  PowerShell で次のコマンドを実行します。</p>
  <div class="sourceCode" id="cb1"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cargo install ripgrep</span></code></pre></div>
  <p>検索コマンドの例です。</p>
  <div class="sourceCode" id="cb2"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rg <span class="st">&quot;How to use cmake&quot;</span></span></code></pre></div>
  <p>ファイル名だけを表示するときは <code>-l</code>
  オプションが使えます。</p>
  <div class="sourceCode" id="cb3"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>rg <span class="op">-</span>l <span class="st">&quot;ParamID&quot;</span></span></code></pre></div>
  <p>特定のファイルを除外したいときは glob オプションの <code>-g</code>
  が使えます。</p>
  <div class="sourceCode" id="cb4"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rg <span class="op">-</span>g <span class="st">&quot;!*.html&quot;</span> <span class="op">-</span>g <span class="st">&quot;!*.js&quot;</span> <span class="st">&quot;EditController&quot;</span></span></code></pre></div>
  <p>今回はこれだけでなんとかなりました。他のオプションは
  <code>-h</code> で確認できます。</p>
  <div class="sourceCode" id="cb5"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rg <span class="op">-</span>h</span></code></pre></div>
  <h2 id="ビルド"><a href="#ビルド" class="header-anchor"
  aria-hidden="true">ビルド</a></h2>
  <p>ビルド方法はドキュメンテーションと vst3sdk リポジトリの README.md
  に書いてあります。</p>
  <ul>
  <li><a href="https://github.com/steinbergmedia/vst3sdk">GitHub -
  steinbergmedia/vst3sdk: VST 3 Plug-In SDK</a></li>
  <li><a
  href="https://steinbergmedia.github.io/vst3_dev_portal/pages/Tutorials/Using+cmake+for+building+plug-ins.html">Using
  cmake for building VST 3 plug-ins - VST 3 Developer Portal</a></li>
  </ul>
  <p>新規プラグインの作り方は変わったようです (2022-12-28)
  。以下のドキュメンテーションについては検証していません。</p>
  <ul>
  <li><a
  href="https://steinbergmedia.github.io/vst3_dev_portal/pages/Tutorials/Generate+new+plug-in+with+Project+Generator.html">Generate
  a new plug-in with the Project Generator App - VST 3 Developer
  Portal</a></li>
  </ul>
  <h3 id="windows-10-1"><a href="#windows-10-1" class="header-anchor"
  aria-hidden="true">Windows 10</a></h3>
  <p><code>my_plugins/helloworld</code>
  にテンプレートが入っているのでコピーして適当に名前を付けることでプロジェクトを作成します。
  <code>my_plugins</code> は <code>VST3_SDK</code>
  の1階層上のディレクトリに入っています。</p>
  <p>プロジェクト作成後のディレクトリ構造の例です。関係ないディレクトリは省略しています。</p>
  <div class="sourceCode" id="cb6"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>VST_SDK</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">+---</span>my_plugins</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   <span class="op">+---</span>helloworld</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   <span class="op">+---</span>helloworld_with_VSTGUI</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   \<span class="op">---</span>SomeFX <span class="co"># 追加したプロジェクト。 my_plugins/helloworld のコピー。</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>\<span class="op">---</span>VST3_SDK</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>base</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>bin</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>cmake</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>doc</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>pluginterfaces</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>public<span class="op">.</span><span class="fu">sdk</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    \<span class="op">---</span>vstgui4</span></code></pre></div>
  <p><code>my_plugins/CMakeLists.txt</code> に <code>SomeFX</code>
  を追加します。</p>
  <div class="sourceCode" id="cb7"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">add_subdirectory</span>(helloworld)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">add_subdirectory</span>(helloworld_with_VSTGUI)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">add_subdirectory</span>(SomeFX)</span></code></pre></div>
  <p>PowerShell を開いて <code>VST3_SDK</code>
  で次のコマンドを実行します。 cmake のオプションで
  <code>SMTG_MYPLUGINS_SRC_PATH</code>
  を指定することでプロジェクトのパスを追加できます。</p>
  <div class="sourceCode" id="cb8"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mkdir build</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cd</span> build</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>cmake <span class="op">-</span>G<span class="st">&quot;Visual Studio 16 2019&quot;</span> <span class="op">-</span>DSMTG_MYPLUGINS_SRC_PATH<span class="op">=</span><span class="st">&quot;../../my_plugins&quot;</span> <span class="op">..</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>cmake <span class="op">--</span>build <span class="op">.</span></span></code></pre></div>
  <p>これでデバッグビルドが始まります。コードを変更したときは
  <code>build</code> ディレクトリに移動して <code>cmake --build .</code>
  でリビルドできます。</p>
  <p>ビルドのコンフィグを変更するときは <code>cmake-gui</code>
  が使えます。</p>
  <div class="sourceCode" id="cb9"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cmake-gui <span class="co"># build ディレクトリ内で実行する。</span></span></code></pre></div>
  <h4 id="リリースビルド"><a href="#リリースビルド"
  class="header-anchor" aria-hidden="true">リリースビルド</a></h4>
  <p><code>--config Release</code> を追加します。</p>
  <div class="sourceCode" id="cb10"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cmake <span class="op">--</span>build <span class="op">.</span> <span class="op">--</span>config Release</span></code></pre></div>
  <h4 id="bit-x86-ビルド"><a href="#bit-x86-ビルド"
  class="header-anchor" aria-hidden="true">32bit (x86) ビルド</a></h4>
  <p>32bit (x86) でビルドするときは一つ目の cmake のコマンドに
  <code>-A Win32</code> を追加します。</p>
  <div class="sourceCode" id="cb11"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mkdir build32 <span class="co"># 64bit 版と同じディレクトリを使わない。</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cd</span> build32</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>cmake <span class="op">-</span>G<span class="st">&quot;Visual Studio 16 2019&quot;</span> <span class="op">-</span>A Win32 <span class="op">-</span>DSMTG_MYPLUGINS_SRC_PATH<span class="op">=</span><span class="st">&quot;../../my_plugins&quot;</span> <span class="op">..</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>cmake <span class="op">--</span>build <span class="op">.</span></span></code></pre></div>
  <p>ビルドターゲットを 64bit から 32bit
  に変更するとビルドに失敗するときがあります。ビルドが失敗するときは
  <code>build</code> ディレクトリを消して作り直してみてください。</p>
  <ul>
  <li><a
  href="https://stackoverflow.com/questions/55708600/whats-the-cmake-generator-for-visual-studio-2019">c++
  - What’s the cmake generator for Visual Studio 2019 - Stack
  Overflow</a></li>
  <li><a
  href="https://cmake.org/cmake/help/v3.15/generator/Visual%20Studio%2016%202019.html">Visual
  Studio 16 2019 — CMake 3.15.0-rc4 Documentation</a></li>
  </ul>
  <h4 id="デプロイ"><a href="#デプロイ" class="header-anchor"
  aria-hidden="true">デプロイ</a></h4>
  <p>VST 3 プラグインのデバッグビルドは <code>build\VST3\Debug</code>
  、リリースビルドは <code>build\VST3\Release</code>
  に配置されます。ビルドされたプラグインは <code>*.vst3</code>
  という名前のディレクトリにパッケージされています。</p>
  <p>VST 3 プラグインは OS
  ごとにインストールする場所が決まっています。詳細は <a
  href="https://steinbergmedia.github.io/vst3_dev_portal/pages/Technical+Documentation/Locations+Format/Plugin+Locations.html">Plug-in
  Locations - VST 3 Developer Portal</a> に書いてあります。 Windows 10
  では <code>C:\Program Files\Common Files\VST3</code>
  に配置すれば使えるようになります。</p>
  <p>PowerShell
  で関数を作って任意のプラグインをコマンド一つでデプロイできるようにします。
  <code>$PROFILE</code> を開きます。 <code>$PROFILE</code> は bash の
  <code>.bashrc</code> に相当します。</p>
  <div class="sourceCode" id="cb12"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>code <span class="va">$PROFILE</span></span></code></pre></div>
  <p>次のコードを <code>$PROFILE</code> に追加します。</p>
  <div class="sourceCode" id="cb13"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> cpvst<span class="op">(</span><span class="va">$name</span><span class="op">,</span> <span class="op">[</span><span class="dt">switch</span><span class="op">]</span> <span class="va">$release</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">$target_dir</span> <span class="op">=</span> <span class="cf">if</span> <span class="op">(</span><span class="va">$release</span><span class="op">)</span> <span class="op">{</span> <span class="st">&quot;Release&quot;</span> <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span> <span class="st">&quot;Debug&quot;</span> <span class="op">}</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">$vst_path</span> <span class="op">=</span> <span class="st">&quot;.\VST3\</span><span class="va">$target_dir</span><span class="st">\</span><span class="va">$name</span><span class="st">.vst3&quot;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Copy-Item</span> <span class="va">$vst_path</span> <span class="op">-</span>Destination <span class="st">&quot;C:\Program Files\Common Files\VST3&quot;</span> <span class="op">-</span>Force <span class="op">-</span>Recurse</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p><code>$PROFILE</code> を読み込んで更新します。 bash の
  <code>source</code> と同じような操作です。</p>
  <div class="sourceCode" id="cb14"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="va">$PROFILE</span></span></code></pre></div>
  <p><code>C:\Program Files\Common Files\VST3</code>
  にファイルをコピーするには管理者権限が必要ですが、手間を省くために開発を行っているユーザに書き込み権限を与えます。エクスプローラーで
  <code>VST3</code>
  を右クリックしてプロパティを開きます。タブからセキュリティを選んで「アクセス許可を変更するには[編集]をクリックします。」というテキストの横にある編集ボタンをクリックします。上のほうにあるグループ名またはユーザ名のリストから開発を行っているユーザを選択します。私の環境では
  Users (DESKTOP-****)
  のような名前がついていました。ユーザを選択したら下のほうにあるアクセス許可のリストの書き込みにチェックを入れて
  OK で <code>VST3</code> への書き込みができるようになります。</p>
  <p>これで <code>cpvst</code> が使えるようになりました。</p>
  <div class="sourceCode" id="cb15"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cpvst helloworld      <span class="co"># build/VST3/Debug/helloworld.vst3 をデプロイ。</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>cpvst SomeFX <span class="op">-</span>release <span class="co"># build/VST3/Release/SomeFX.vst3 をデプロイ。</span></span></code></pre></div>
  <h3 id="linux-1"><a href="#linux-1" class="header-anchor"
  aria-hidden="true">Linux</a></h3>
  <p>Windows 10 の手順とほとんど同じですが <code>cmake</code>
  に渡す引数が変わります。</p>
  <div class="sourceCode" id="cb16"><pre
  class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> build</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> build</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Debug <span class="at">-DSMTG_MYPLUGINS_SRC_PATH</span><span class="op">=</span><span class="st">&quot;../../my_plugins&quot;</span> ..</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cmake</span> <span class="at">--build</span> .</span></code></pre></div>
  <p>リリースビルドのときは <code>-DCMAKE_BUILD_TYPE=Debug</code> を
  <code>-DCMAKE_BUILD_TYPE=Release</code> に変えます。</p>
  <p><code>cmake</code> でビルドするとデプロイを自動的に行ってくれます。
  <code>VST3_SDK/build/VST3/Debug/</code> あるいは
  <code>VST3_SDK/build/VST3/Release/</code> 内のディレクトリが
  <code>~/.vst3</code> にリンクされます。</p>
  <h3 id="cmake-のオプション"><a href="#cmake-のオプション"
  class="header-anchor" aria-hidden="true">CMake のオプション</a></h3>
  <h4 id="サンプルプロジェクトのビルドを無効にする"><a
  href="#サンプルプロジェクトのビルドを無効にする" class="header-anchor"
  aria-hidden="true">サンプルプロジェクトのビルドを無効にする</a></h4>
  <p>サンプルプロジェクトのビルドを無効にするときは
  <code>SMTG_ADD_VST3_HOSTING_SAMPLES</code> と
  <code>SMTG_ADD_VST3_PLUGINS_SAMPLES</code> に <code>FALSE</code>
  を指定します。</p>
  <div class="sourceCode" id="cb17"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ` (backtick) は powershell で次の行に続くという意味。 bash の \ と同じ。</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cmake <span class="op">-</span>G<span class="st">&quot;Visual Studio 16 2019&quot;</span> `</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span>DSMTG_MYPLUGINS_SRC_PATH<span class="op">=</span><span class="st">&quot;../../Plugins&quot;</span> `</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span>DSMTG_ADD_VST3_HOSTING_SAMPLES<span class="op">=</span>FALSE `</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span>DSMTG_ADD_VST3_PLUGINS_SAMPLES<span class="op">=</span>FALSE `</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">..</span></span></code></pre></div>
  <h4 id="コンパイラオプションの変更"><a
  href="#コンパイラオプションの変更" class="header-anchor"
  aria-hidden="true">コンパイラオプションの変更</a></h4>
  <p>プラグインのコンパイラオプションを指定するときは
  <code>my_plugins/SomePlugin/CMakeLists.txt</code> に
  <code>target_compile_options</code> を追加します。次の例では AVX2
  を有効にするオプションを指定しています。</p>
  <div class="sourceCode" id="cb18"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># C++17 を有効化。</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(<span class="dv">CMAKE_CXX_STANDARD</span> 17)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(<span class="dv">CMAKE_CXX_STANDARD_REQUIRED</span> True)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">smtg_add_vst3plugin</span>(<span class="dv">${target}</span> <span class="dv">${plug_sources}</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="dv">MSVC</span>) <span class="co"># Windows, MSVC</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">target_compile_options</span>(<span class="dv">${target}</span> <span class="bn">PRIVATE</span> /O2 /fp:fast /arch:AVX2)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">elseif</span>(<span class="dv">UNIX</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">APPLE</span>) <span class="co"># macOS, clang</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">target_compile_options</span>(<span class="dv">${target}</span> <span class="bn">PRIVATE</span> -O3 -fPIC -fno-aligned-allocation -Wall -mfma -mavx2)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>() <span class="co"># Linux</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">target_compile_options</span>(<span class="dv">${target}</span> <span class="bn">PRIVATE</span> -O3 -fPIC -mfma -mavx2)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">endif</span>()</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span>()</span></code></pre></div>
  <h2 id="テスト"><a href="#テスト" class="header-anchor"
  aria-hidden="true">テスト</a></h2>
  <p>ビルドを終えたらプラグインの動作をテストします。</p>
  <h3 id="自動テスト"><a href="#自動テスト" class="header-anchor"
  aria-hidden="true">自動テスト</a></h3>
  <p>VST 3 SDK
  はプラグインのビルドのたびに自動でいくつかのテストを行ってくれます。
  API
  の使い方を間違えているなどの明らかなミスは、このテストで捉えられます。</p>
  <h3 id="vst3plugintesthost-1"><a href="#vst3plugintesthost-1"
  class="header-anchor" aria-hidden="true">VST3PluginTestHost</a></h3>
  <p>GUI とプラグイン情報のチェックには VST3PluginTestHost
  が使えます。</p>
  <p>VST3PluginTestHost のインストーラは
  <code>VST_SDK/VST3_SDK/bin</code> 以下のディレクトリに入っています。
  Linux 版は無いようです。 GitHub のリポジトリには VST3PluginTestHost
  が含まれていないようなので注意してください。</p>
  <p>簡易なシーケンサがついていますが MIDI
  キーボードがあれば演奏することができます。 wav
  を読み込んでエフェクタに音を送ることができますが、モノラルになってしまいます。音のレンダリングができないので、チューニングなどの細かい確認をするには向いていません。</p>
  <h3 id="reaper"><a href="#reaper" class="header-anchor"
  aria-hidden="true">REAPER</a></h3>
  <p>音をレンダリングして確認したいときは <a
  href="https://www.reaper.fm/">REAPER</a> が使えます。 Linux
  でも動きます。</p>
  <h2 id="vst3-プラグインの大まかな仕組み"><a
  href="#vst3-プラグインの大まかな仕組み" class="header-anchor"
  aria-hidden="true">VST3 プラグインの大まかな仕組み</a></h2>
  <p>VST3 プラグインは大きく次の3つの部品に分けることができます。</p>
  <ul>
  <li>Edit Controller (コントローラ)</li>
  <li>Processor (プロセッサ)</li>
  <li>Editor View (エディタ)</li>
  </ul>
  <p>コントローラはパラメータとユーザインタフェースの橋渡し役です。</p>
  <p>プロセッサでは信号処理を行います。</p>
  <p>コントローラからプロセッサ、あるいはプロセッサからコントローラへとパラメータを直接を伝えることはありません。コントローラとプロセッサの間でのパラメータの伝達は、DAWなどの
  VST3 ホストの仕事です。</p>
  <p>エディタでは GUI
  に関する処理を行います。エディタはコントローラの下にぶら下がるような関係になっています。</p>
  <p><img src="img/VST3_overview.png" width="320"></p>
  <p>コントローラとプロセッサをファクトリに登録することで VST3
  プラグインが使えるようになります。ファクトリのコードはテンプレートが用意されているのでほとんど書くことはありません。</p>
  <h2 id="デバッグ"><a href="#デバッグ" class="header-anchor"
  aria-hidden="true">デバッグ</a></h2>
  <ul>
  <li>TODO: テスト</li>
  </ul>
  <p>ここに書いてある内容は動作確認していないので間違いがあるかもしれません。
  noteexpressionsynth のコードから辿って見つけました。</p>
  <h3 id="ブレークポイント"><a href="#ブレークポイント"
  class="header-anchor" aria-hidden="true">ブレークポイント</a></h3>
  <p><code>FDebugBreak</code> が使えます。</p>
  <p><code>FDebugPrint</code> の引数は <code>printf</code>
  と同じです。</p>
  <ul>
  <li>未検証: Windows では <code>build/WIN_PDB64</code> に入っている
  <code>プラグイン名.pdb</code> ファイルを
  <code>build/VST3/Debug/プラグイン名.vst3/Contents/x86_64-win</code>
  にコピーしておけば、 <code>FDebugBreak</code>
  が呼ばれたときにデバッガが起動するはず。</li>
  </ul>
  <div class="sourceCode" id="cb19"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;base/source/fdebug.h&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> somewhere<span class="op">(</span><span class="dt">float</span> value<span class="op">)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#if DEVELOPMENT </span><span class="co">// 必ず DEVELOPMENT で囲むこと。</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  FDebugBreak<span class="op">(</span><span class="st">&quot;Start debugging at somewhere.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span></code></pre></div>
  <ul>
  <li><a
  href="https://docs.microsoft.com/en-us/visualstudio/debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger?view=vs-2019">Set
  symbol (.pdb) and source files in the debugger - Visual Studio |
  Microsoft Docs</a></li>
  </ul>
  <h3 id="プリント"><a href="#プリント" class="header-anchor"
  aria-hidden="true">プリント</a></h3>
  <p><code>FDebugPrint</code> が使えます。</p>
  <p>出力を見るには DAW がデバッグ出力をサポートしている必要があります。
  FL Studio 20.5 では左上のメニューから OPTIONS -&gt; Debugging log
  でデバッグ出力を表示できます。</p>
  <p><code>FDebugPrint</code> の引数は <code>printf</code>
  と同じです。</p>
  <div class="sourceCode" id="cb20"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;base/source/fdebug.h&quot;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> somewhere<span class="op">(</span><span class="dt">float</span> value<span class="op">)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#if DEVELOPMENT </span><span class="co">// 必ず DEVELOPMENT で囲むこと。</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  FDebugPrint<span class="op">(</span><span class="st">&quot;somewhere, value: </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> value<span class="op">);</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span></code></pre></div>
  <p><code>base/source/fdebug.h</code> のコメントによると
  <code>FDebugPrint</code> を直接使わずに、 <code>FDebugPrint</code>
  をラップしたマクロを使うことが推奨されています。</p>
  <div class="sourceCode" id="cb21"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// base/source/fdebug.h</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">/** Send &quot;comment&quot; string to the debugger for display. */</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_WARNING</span><span class="op">(</span>comment<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">(</span><span class="sc">%d</span><span class="st">) : </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span><span class="pp"> </span><span class="ot">__FILE__</span><span class="op">,</span><span class="pp"> </span><span class="ot">__LINE__</span><span class="op">,</span><span class="pp"> </span>comment<span class="op">);</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">/** </span><span class="an">@name</span><span class="co"> </span><span class="do">Shortcut</span><span class="co"> </span><span class="do">macros</span><span class="co"> </span><span class="do">for</span><span class="co"> </span><span class="do">sending</span><span class="co"> </span><span class="do">strings</span><span class="co"> </span><span class="do">to</span><span class="co"> </span><span class="do">the</span><span class="co"> </span><span class="do">debugger</span><span class="co"> </span><span class="do">for</span><span class="co"> </span><span class="do">display.</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    First parameter is always the format string (printf like).</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">///</span><span class="re">@{</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_DBPRT0</span><span class="op">(</span>a<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span>a<span class="op">);</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_DBPRT1</span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">);</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_DBPRT2</span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">);</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_DBPRT3</span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">,</span><span class="pp"> </span>d<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">,</span><span class="pp"> </span>d<span class="op">);</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_DBPRT4</span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">,</span><span class="pp"> </span>d<span class="op">,</span><span class="pp"> </span>e<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">,</span><span class="pp"> </span>d<span class="op">,</span><span class="pp"> </span>e<span class="op">);</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SMTG_DBPRT5</span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">,</span><span class="pp"> </span>d<span class="op">,</span><span class="pp"> </span>e<span class="op">,</span><span class="pp"> </span>f<span class="op">)</span><span class="pp"> </span>FDebugPrint<span class="pp"> </span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">,</span><span class="pp"> </span>c<span class="op">,</span><span class="pp"> </span>d<span class="op">,</span><span class="pp"> </span>e<span class="op">,</span><span class="pp"> </span>f<span class="op">);</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">///</span><span class="re">@}</span></span></code></pre></div>
  <ul>
  <li><code>base/source/fdebug.h</code></li>
  <li><a
  href="https://en.cppreference.com/w/cpp/utility/variadic">Variadic
  functions - cppreference.com</a></li>
  </ul>
  <h2 id="helloworld-プラグインを何とかする"><a
  href="#helloworld-プラグインを何とかする" class="header-anchor"
  aria-hidden="true">helloworld プラグインを何とかする</a></h2>
  <p>テンプレートとして用意されている <code>my_plugins/helloworld</code>
  をリファクタリングしつつ、パラメータ追加のワークフローを作っていきます。</p>
  <p>ビルドの節で <code>my_plugins/helloworld</code>
  をコピーして作成した <code>my_plugins/SomeFX</code>
  に変更を加えていきます。 <code>my_plugins/SomeFX/**</code>
  に該当するパスは <code>my_plugins</code> を省略して
  <code>SomeFX/**</code> のように書いています。</p>
  <h3 id="ファイルの配置の変更"><a href="#ファイルの配置の変更"
  class="header-anchor" aria-hidden="true">ファイルの配置の変更</a></h3>
  <p>コードが書いてあるファイルが7個しかないので、ディレクトリ移動の煩雑さを減らすために一つのディレクトリにまとめてしまいます。</p>
  <div class="sourceCode" id="cb22"><pre
  class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">+---</span>CMakeLists<span class="op">.</span><span class="fu">txt</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">+---</span>resource</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   <span class="op">+---</span>Info<span class="op">.</span><span class="fu">plist</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="op">|</span>   \<span class="op">---</span>plug<span class="op">.</span><span class="fu">rc</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>\<span class="op">---</span>source</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>plugcontroller<span class="op">.</span><span class="fu">cpp</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>plugcontroller<span class="op">.</span><span class="fu">hpp</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>plugfactory<span class="op">.</span><span class="fu">cpp</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>plugids<span class="op">.</span><span class="fu">hpp</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>plugprocessor<span class="op">.</span><span class="fu">cpp</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+---</span>plugprocessor<span class="op">.</span><span class="fu">hpp</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    \<span class="op">---</span>version<span class="op">.</span><span class="fu">hpp</span></span></code></pre></div>
  <p>ここではヘッダの拡張子に “.hpp” を使っています。</p>
  <p><code>SomeFX/CMakeList.txt</code> を変更します。</p>
  <div class="sourceCode" id="cb23"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(plug_sources</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    source/plugcontroller.hpp</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    source/plugids.hpp</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    source/plugprocessor.hpp</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    source/version.hpp</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    source/plugfactory.cpp</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    source/plugcontroller.cpp</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    source/plugprocessor.cpp</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
  <p><code>SomeFX/resource/plug.rc</code> の <code>version.h</code>
  のインクルードパスを <code>version.hpp</code> に変更します。</p>
  <pre><code>#include &quot;../source/version.hpp&quot;</code></pre>
  <h3 id="名前やfuidの設定"><a href="#名前やfuidの設定"
  class="header-anchor" aria-hidden="true">名前やFUIDの設定</a></h3>
  <p>この項の内容は <code>doc/vstinterfaces/addownplugs.html</code>
  に書いてあることと同じなので、あわせて参照することをお勧めします。</p>
  <p><code>SomeFX/CMakeLists.txt</code> を変更します。</p>
  <div class="sourceCode" id="cb25"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(target SomeFX)</span></code></pre></div>
  <p><code>SomeFX/source/plugids.hpp</code> にある 2 つの
  <code>FUID</code> を変更します。コメントにあるように <a
  href="https://www.guidgenerator.com/">Online GUID Generator</a>
  を使って生成できます。</p>
  <p>次のコードの ID をコピーして使わないでください。 ID が競合すると
  DAW で予期しないプラグインがロードされる不具合につながります。</p>
  <div class="sourceCode" id="cb26"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="at">static</span> <span class="at">const</span> FUID MyProcessorUID<span class="op">(</span><span class="bn">0x00000000</span><span class="op">,</span> <span class="bn">0x00000000</span><span class="op">,</span> <span class="bn">0x00000000</span><span class="op">,</span> <span class="bn">0x00000000</span><span class="op">);</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">static</span> <span class="at">const</span> FUID MyControllerUID<span class="op">(</span><span class="bn">0x11111111</span><span class="op">,</span> <span class="bn">0x11111111</span><span class="op">,</span> <span class="bn">0x11111111</span><span class="op">,</span> <span class="bn">0x11111111</span><span class="op">);</span></span></code></pre></div>
  <p>プラグインの名前などは <code>SomeFX/source/version.hpp</code>
  で変更できます。</p>
  <div class="sourceCode" id="cb27"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringPluginName </span><span class="st">&quot;Hello World&quot;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringOriginalFilename </span><span class="st">&quot;SomeFX.vst3&quot;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#if SMTG_PLATFORM_64</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringFileDescription </span>stringPluginName<span class="pp"> </span><span class="st">&quot; VST3-SDK (64Bit)&quot;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringFileDescription </span>stringPluginName<span class="pp"> </span><span class="st">&quot; VST3-SDK&quot;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringCompanyName </span><span class="st">&quot;Some Company</span><span class="sc">\0</span><span class="st">&quot;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringCompanyWeb </span><span class="st">&quot;https://example.com&quot;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringCompanyEmail </span><span class="st">&quot;mailto:someaddress@example.com&quot;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringLegalCopyright </span><span class="st">&quot;(c) 2019 Someone&quot;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define stringLegalTrademarks </span><span class="st">&quot;VST is a trademark of Steinberg Media Technologies GmbH&quot;</span></span></code></pre></div>
  <p>プラグインの名前を変えるときは <code>Info.plist</code> の
  <code>SomeFX</code> の部分を変更します。</p>
  <ul>
  <li>10行目: <code>&lt;string&gt;SomeFX&lt;/string&gt;</code></li>
  <li>14行目:
  <code>&lt;string&gt;com.steinberg.vst3.SomeFX&lt;/string&gt;</code></li>
  </ul>
  <p>あとは各ファイルで定義されている名前空間 <code>HelloWorld</code>
  を適当に変更します。</p>
  <h3 id="音を出す"><a href="#音を出す" class="header-anchor"
  aria-hidden="true">音を出す</a></h3>
  <p><code>SomeFX</code> を変更して音が出るようにします。</p>
  <p><code>SomeFX/source/plugprocessor.cpp</code> の
  <code>PlugProcessor::process</code>
  で音のデータをバッファに書き込みます。</p>
  <div class="sourceCode" id="cb28"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">//--- Process Audio---------------------</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">//--- ----------------------------------</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">.</span>numInputs <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> kResultOk<span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">.</span>numOutputs <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> kResultOk<span class="op">;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">.</span>numSamples <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> kResultOk<span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">// double は処理しない。</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">.</span>symbolicSampleSize <span class="op">==</span> Vst<span class="op">::</span>kSample64<span class="op">)</span> <span class="cf">return</span> kResultOk<span class="op">;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">// この条件を追加しないと out of bounds へのアクセスでクラッシュする。</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">.</span>inputs<span class="op">[</span><span class="dv">0</span><span class="op">].</span>numChannels <span class="op">&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="cf">return</span> kResultOk<span class="op">;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">.</span>outputs<span class="op">[</span><span class="dv">0</span><span class="op">].</span>numChannels <span class="op">&lt;</span> <span class="dv">2</span><span class="op">)</span> <span class="cf">return</span> kResultOk<span class="op">;</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">*</span>in0 <span class="op">=</span> data<span class="op">.</span>inputs<span class="op">[</span><span class="dv">0</span><span class="op">].</span>channelBuffers32<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">*</span>in1 <span class="op">=</span> data<span class="op">.</span>inputs<span class="op">[</span><span class="dv">0</span><span class="op">].</span>channelBuffers32<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">*</span>out0 <span class="op">=</span> data<span class="op">.</span>outputs<span class="op">[</span><span class="dv">0</span><span class="op">].</span>channelBuffers32<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">*</span>out1 <span class="op">=</span> data<span class="op">.</span>outputs<span class="op">[</span><span class="dv">0</span><span class="op">].</span>channelBuffers32<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">// バイパス。</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int32_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span>numSamples<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  out0<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> in0<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  out1<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> in1<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>このコードは入力と出力のチャンネル数が同じであることを仮定しています。入出力のチャンネル数は
  <code>PlugProcessor::initialize</code> で指定できます。</p>
  <p><code>kResultOk</code> は 0 で <code>kResultFalse</code> は 1
  なので if の条件で出てくるときは注意してください。 VST3 SDK では
  <code>if (isIt() == kResultFalse) doIt();</code> のように
  <code>==</code> でチェックしている箇所があります。</p>
  <h3 id="パラメータの追加"><a href="#パラメータの追加"
  class="header-anchor" aria-hidden="true">パラメータの追加</a></h3>
  <p>このままだとパラメータの管理が手間になるのでリファクタリングします。</p>
  <h4 id="vst3-のパラメータ"><a href="#vst3-のパラメータ"
  class="header-anchor" aria-hidden="true">VST3 のパラメータ</a></h4>
  <p>VST3
  では1つのパラメータをコントローラとプロセッサの2か所で保持させることになります。</p>
  <ul>
  <li>TODO 図の追加</li>
  </ul>
  <h4 id="パラメータ用のヘッダとソースの作成"><a
  href="#パラメータ用のヘッダとソースの作成" class="header-anchor"
  aria-hidden="true">パラメータ用のヘッダとソースの作成</a></h4>
  <p>TODO 変更</p>
  <ul>
  <li><code>SomeFX/source/plugid.hpp</code></li>
  <li><code>SomeFX/source/plugcontroller.cpp</code></li>
  <li><code>SomeFX/source/plugprocessor.hpp</code></li>
  <li><code>SomeFX/source/plugprocessor.cpp</code></li>
  </ul>
  <h3 id="hello-gui"><a href="#hello-gui" class="header-anchor"
  aria-hidden="true">Hello GUI</a></h3>
  <p>VSTGUI 4.8 ではコードで直接 GUI を書く方法と、 VST3 inline UI
  editor を使って GUI を作る方法があります。ここでは VST3 inline UI
  editor という名前を短くして UI エディタと呼ぶことにします。</p>
  <p>本格的な開発をするならコードで直接 GUI
  を書く方法をお勧めします。私が試した限りでは FL Studio 20.5 と Reaper
  5.980 では UI エディタを使う方法に不具合がありました。不具合については
  GUI -&gt; VST3 inline UI editor を使った GUI の作成 -&gt;
  ワークアラウンド にまとめています。</p>
  <p>ここでは例として手軽でコードが少ない UI エディタを使う方法で GUI
  を作ります。</p>
  <p><code>SomeFX/source/plugcontroller.hpp</code> を変更します。</p>
  <ul>
  <li><code>vst3editor.h</code> をインクルード。</li>
  <li><code>createView</code> を追加。</li>
  </ul>
  <div class="sourceCode" id="cb29"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui/plugin-bindings/vst3editor.h&quot;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugController <span class="op">:</span> <span class="kw">public</span> Vst<span class="op">::</span>EditController <span class="op">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  IPlugView <span class="op">*</span>PLUGIN_API createView<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span> SMTG_OVERRIDE</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>name <span class="op">&amp;&amp;</span> strcmp<span class="op">(</span>name<span class="op">,</span> <span class="st">&quot;editor&quot;</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">new</span> VSTGUI<span class="op">::</span>VST3Editor<span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="st">&quot;view&quot;</span><span class="op">,</span> <span class="st">&quot;plug.uidesc&quot;</span><span class="op">);</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>SomeFX/CMakeLists.txt</code> を変更します。</p>
  <div class="sourceCode" id="cb30"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">smtg_add_vst3plugin</span>(<span class="dv">${target}</span> <span class="dv">${plug_sources}</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set_target_properties</span>(<span class="dv">${target}</span> <span class="ot">PROPERTIES</span> <span class="dv">${SDK_IDE_MYPLUGINS_FOLDER}</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">target_include_directories</span>(<span class="dv">${target}</span> <span class="bn">PUBLIC</span> <span class="dv">${VSTGUI_ROOT}</span>/vstgui4) <span class="co"># 追加。</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">target_link_libraries</span>(<span class="dv">${target}</span> <span class="bn">PRIVATE</span> base sdk vstgui_support)    <span class="co"># vstgui_support を追加。</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span></code></pre></div>
  <p>ビルドしたプラグインを開くと真っ黒の画面が表示されます。黒い部分を右クリックするとコンテクストメニューが開いて
  UI エディタでの編集が選択できます。</p>
  <p>UI エディタの使い方は
  <code>vstgui4/vstgui/Documentation/html/page_uidescription_editor.html</code>
  に書いてあります。</p>
  <ul>
  <li>TODO 画像</li>
  <li>TODO tag の設定。</li>
  </ul>
  <p>UI エディタでの編集が終わったらの左上にあるメニューから File -&gt;
  Save As を選んで <code>plug.uidesc</code> を保存します。保存した
  <code>plug.uidesc</code> を適当なディレクトリにおいて
  <code>SomeFX/CMakeLists.txt</code> の
  <code>smtg_add_vst3_resource</code>
  でパスを指定することでリソースに追加できます。</p>
  <pre><code># ...
target_link_libraries(${target} PRIVATE base sdk vstgui_support) # 上で変更した行。

# リソースの追加。
# 初回作成時など UI エディタで作った uidesc ファイルがないときはコメントアウトしておく。
smtg_add_vst3_resource(${target} &quot;resource/plug.uidesc&quot;)

# ...</code></pre>
  <p>画像ファイルを使うときも <code>smtg_add_vst3_resource</code>
  でリソースに追加できます。</p>
  <h3 id="リファクタリング"><a href="#リファクタリング"
  class="header-anchor" aria-hidden="true">リファクタリング</a></h3>
  <ul>
  <li>TODO</li>
  </ul>
  <h2 id="ポインタの扱いについて"><a href="#ポインタの扱いについて"
  class="header-anchor"
  aria-hidden="true">ポインタの扱いについて</a></h2>
  <p>vst3sdk
  では生ポインタを扱う場面が出てきますが、参照カウンタが使えるので use
  after free を防ぐことができます。</p>
  <p><code>new</code> したインスタンスを生ポインタに格納した後は
  <code>remember()</code>
  で参照カウントを増やします。また、メモリリークを防ぐためにクラスのデストラクタで必ず
  <code>forget()</code>
  を呼んで参照カウントを減らします。以下は私が実際に書いて動いた適当な例です。</p>
  <div class="sourceCode" id="cb32"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugController <span class="op">:</span> <span class="kw">public</span> Vst<span class="op">::</span>EditController<span class="op">,</span> <span class="kw">public</span> Vst<span class="op">::</span>IMidiMapping <span class="op">{</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  Steinberg<span class="op">::</span>Vst<span class="op">::</span>PlugEditor <span class="op">*</span>editor <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">~</span>PlugController<span class="op">()</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>editor<span class="op">)</span> editor<span class="op">-&gt;</span>forget<span class="op">();</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>IPlugView <span class="op">*</span>PLUGIN_API PlugController<span class="op">::</span>createView<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>name<span class="op">)</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// オートメーションなどでホストから変更されたパラメータを GUI に伝えるためにエディタクラスのポインタを持っておく。</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>name <span class="op">&amp;&amp;</span> strcmp<span class="op">(</span>name<span class="op">,</span> <span class="st">&quot;editor&quot;</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>editor <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span> editor<span class="op">-&gt;</span>forget<span class="op">();</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    editor <span class="op">=</span> <span class="kw">new</span> Vst<span class="op">::</span>PlugEditor<span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    editor<span class="op">-&gt;</span>remember<span class="op">();</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> editor<span class="op">;</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>CMake では C++14
  のフラグを立てていながらスマートポインタを使っていないのが疑問でしたが、
  Wikipedia によると <a
  href="https://en.wikipedia.org/wiki/Virtual_Studio_Technology#History">VST
  3 がリリースされたのは 2008 年</a>なので C++11
  が使えなかったのだろうと思います。</p>
  <h2 id="gui"><a href="#gui" class="header-anchor"
  aria-hidden="true">GUI</a></h2>
  <p>主にカスタムビューの作成についてまとめています。</p>
  <h3 id="vst3-inline-ui-editor-を使った-gui-の作成"><a
  href="#vst3-inline-ui-editor-を使った-gui-の作成"
  class="header-anchor" aria-hidden="true">VST3 inline UI editor
  を使った GUI の作成</a></h3>
  <h4 id="オプションメニュー-コンボボックス-の追加"><a
  href="#オプションメニュー-コンボボックス-の追加" class="header-anchor"
  aria-hidden="true">オプションメニュー (コンボボックス) の追加</a></h4>
  <p>オプションメニューのアイテムは <code>StringListParameter</code>
  を使うことで設定できます。</p>
  <p>オプションメニューとリンクするパラメータを
  <code>SomeFX/source/plugcontroller.cpp</code> の
  <code>initialize</code> に追加します。</p>
  <div class="sourceCode" id="cb33"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;public.sdk/source/vst/vstparameters.h&quot;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>tresult PLUGIN_API PlugController<span class="op">::</span>initialize<span class="op">(</span>FUnknown <span class="op">*</span>context<span class="op">)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> parameterType <span class="op">=</span> <span class="kw">new</span> Vst<span class="op">::</span>StringListParameter<span class="op">(</span>USTRING<span class="op">(</span><span class="st">&quot;Type&quot;</span><span class="op">),</span> ParameterID<span class="op">::</span>type<span class="op">);</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  parameterType<span class="op">-&gt;</span>appendString<span class="op">(</span>USTRING<span class="op">(</span><span class="st">&quot;uhhyou&quot;</span><span class="op">));</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  parameterType<span class="op">-&gt;</span>appendString<span class="op">(</span>USTRING<span class="op">(</span><span class="st">&quot;yey&quot;</span><span class="op">));</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  parameters<span class="op">.</span>addParameter<span class="op">(</span>parameterType<span class="op">);</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>あとは UI エディタで <code>StringListParameter</code>
  として追加したパラメータのIDをオプションメニューの control-tag
  として指定すれば設定完了です。</p>
  <ul>
  <li><code>public.sdk/samples/vst/note_expression_synth/source/note_expression_synth_controller.cpp</code></li>
  <li><code>public.sdk/source/vst/vstparameters.*</code></li>
  </ul>
  <h4 id="ワークアラウンド"><a href="#ワークアラウンド"
  class="header-anchor" aria-hidden="true">ワークアラウンド</a></h4>
  <p>FL Studio 20.5
  ではプラグインのウィンドウの大きさを変更できないので編集が困難です。ワークアラウンドとして
  <code>plug.uidesc</code>
  を直接編集して編集画面の大きさを変更することができます。</p>
  <p>いったん UI エディタを開いて何も編集せずにメニューの Save as で
  <code>plug.uidesc</code> を保存します。 <code>plug.uidesc</code>
  をテキストエディタで開いて custom -&gt; attributes -&gt; EditorSize
  を変更することでGUI エディタのウィンドウの大きさを設定できます。
  EditorSize のフォーマットは <code>"x, y, width, height"</code>
  となっています。変更した <code>plug.uidesc</code>
  をリソースとしてプラグインに追加すると次回から UI
  エディタのウィンドウが設定した大きさになります。</p>
  <p>Reaper v5.980 では UI
  エディタを開こうとするとクラッシュするので使えません。</p>
  <h4 id="カスタムビューの追加"><a href="#カスタムビューの追加"
  class="header-anchor" aria-hidden="true">カスタムビューの追加</a></h4>
  <p>カスタムビューの概要については コードでGUI -&gt;
  カスタムビューの実装と関連するコントロールの表示の変更
  を参照してください。</p>
  <p>サイン波を表示するカスタムビューを作ります。</p>
  <p>次の3つのファイルを作成します。</p>
  <ul>
  <li><code>SomeFX/source/gui/waveview.hpp</code></li>
  <li><code>SomeFX/source/gui/waveview.cpp</code></li>
  <li><code>SomeFX/source/gui/waveviewcreator.cpp</code></li>
  </ul>
  <p><code>SomeFX/source/gui/waveview.hpp</code> の内容です。</p>
  <div class="sourceCode" id="cb34"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui4/vstgui/vstgui.h&quot;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> VSTGUI <span class="op">{</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WaveView <span class="op">:</span> <span class="kw">public</span> CControl <span class="op">{</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  WaveView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">);</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> draw<span class="op">(</span>CDrawContext <span class="op">*</span>pContext<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  CLASS_METHODS<span class="op">(</span>WaveView<span class="op">,</span> CControl<span class="op">);</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> lfo<span class="op">(</span><span class="dt">double</span> phase<span class="op">);</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> gain <span class="op">=</span> <span class="fl">0.9</span><span class="op">;</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> shape <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> phase <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  CLineStyle lineStyle<span class="op">{</span>CLineStyle<span class="op">::</span>kLineCapRound<span class="op">,</span> CLineStyle<span class="op">::</span>kLineJoinRound<span class="op">};</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  CDrawContext<span class="op">::</span>PointList points<span class="op">;</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace VSTGUI</span></span></code></pre></div>
  <p><code>SomeFX/source/gui/waveview.cpp</code> の内容です。</p>
  <div class="sourceCode" id="cb35"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;waveview.hpp&quot;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> VSTGUI <span class="op">{</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>WaveView<span class="op">::</span>WaveView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">)</span> <span class="op">:</span> CControl<span class="op">(</span>size<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> WaveView<span class="op">::</span>draw<span class="op">(</span>CDrawContext <span class="op">*</span>pContext<span class="op">)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setDrawMode<span class="op">(</span>CDrawMode<span class="op">(</span>CDrawModeFlags<span class="op">::</span>kAntiAliasing<span class="op">));</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  CDrawContext<span class="op">::</span>Transform t<span class="op">(</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>pContext<span class="op">,</span> CGraphicsTransform<span class="op">().</span>translate<span class="op">(</span>getViewSize<span class="op">().</span>getTopLeft<span class="op">()));</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> width <span class="op">=</span> getWidth<span class="op">();</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> height <span class="op">=</span> getHeight<span class="op">();</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> borderWidth <span class="op">=</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> halfBorderWidth <span class="op">=</span> borderWidth <span class="op">/</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background.</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineWidth<span class="op">(</span>borderWidth<span class="op">);</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFillColor<span class="op">(</span>pal<span class="op">.</span>background<span class="op">());</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawRect<span class="op">(</span>CRect<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">),</span> kDrawFilled<span class="op">);</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Waveform.</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineWidth<span class="op">(</span><span class="fl">2.0</span><span class="op">);</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineStyle<span class="op">(</span>lineStyle<span class="op">);</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFrameColor<span class="op">(</span>CColor<span class="op">(</span><span class="dv">19</span><span class="op">,</span> <span class="dv">193</span><span class="op">,</span> <span class="dv">54</span><span class="op">,</span> <span class="dv">255</span><span class="op">));</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">size_t</span> size <span class="op">=</span> <span class="op">(</span><span class="dt">size_t</span><span class="op">)(</span>width <span class="op">+</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>points<span class="op">.</span>size<span class="op">()</span> <span class="op">!=</span> size<span class="op">)</span> points<span class="op">.</span>resize<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x <span class="op">&lt;</span> points<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>x<span class="op">)</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    points<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> CPoint<span class="op">((</span>CCoord<span class="op">)</span>x<span class="op">,</span> height <span class="op">*</span> lfo<span class="op">(</span>x <span class="op">/</span> width<span class="op">));</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawPolygon<span class="op">(</span>points<span class="op">);</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Always draw border at last. Otherwise, inner object will be drawn over border.</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFrameColor<span class="op">(</span>isMouseEntered <span class="op">?</span> pal<span class="op">.</span>highlightMain<span class="op">()</span> <span class="op">:</span> pal<span class="op">.</span>border<span class="op">());</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawRect<span class="op">(</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    CRect<span class="op">(</span>halfBorderWidth<span class="op">,</span> halfBorderWidth<span class="op">,</span> width<span class="op">,</span> height<span class="op">),</span> kDrawStroked<span class="op">);</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  setDirty<span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> WaveView<span class="op">::</span>lfo<span class="op">(</span><span class="dt">double</span> phase<span class="op">)</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> twopi <span class="op">=</span> <span class="fl">6.283185307179586</span><span class="op">;</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  phase <span class="op">=</span> <span class="kw">this</span><span class="op">-&gt;</span>phase <span class="op">+</span> phase <span class="op">*</span> twopi<span class="op">;</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&gt;</span> twopi<span class="op">)</span> phase <span class="op">-=</span> twopi<span class="op">;</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> sign <span class="op">=</span> <span class="op">(</span>pi <span class="op">&lt;</span> phase<span class="op">)</span> <span class="op">-</span> <span class="op">(</span>phase <span class="op">&lt;</span> pi<span class="op">);</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> wave <span class="op">=</span> gain <span class="op">*</span> sign <span class="op">*</span> pow<span class="op">(</span>fabs<span class="op">(</span>sin<span class="op">(</span>phase<span class="op">)),</span> shape<span class="op">);</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">(</span>wave <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace VSTGUI</span></span></code></pre></div>
  <p><code>SomeFX/source/gui/waveviewcreator.cpp</code> の内容です。</p>
  <div class="sourceCode" id="cb36"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;waveview.hpp&quot;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui4/vstgui/uidescription/detail/uiviewcreatorattributes.h&quot;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui4/vstgui/uidescription/iviewcreator.h&quot;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui4/vstgui/uidescription/uiattributes.h&quot;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui4/vstgui/uidescription/uiviewfactory.h&quot;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui4/vstgui/vstgui.h&quot;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> VSTGUI <span class="op">{</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> UIViewCreator <span class="op">{</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WaveViewCreator <span class="op">:</span> <span class="kw">public</span> ViewCreatorAdapter <span class="op">{</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  WaveViewCreator<span class="op">()</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    UIViewFactory<span class="op">::</span>registerViewCreator<span class="op">(*</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  IdStringPtr getViewName<span class="op">()</span> <span class="at">const</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;WaveView&quot;</span><span class="op">;</span> <span class="co">// カスタムビューの名前。</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  IdStringPtr getBaseViewName<span class="op">()</span> <span class="at">const</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;CControl&quot;</span><span class="op">;</span> <span class="co">// カスタムビューの親クラスの名前。</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  CView <span class="op">*</span>create<span class="op">(</span><span class="at">const</span> UIAttributes <span class="op">&amp;</span>attributes<span class="op">,</span> <span class="at">const</span> IUIDescription <span class="op">*</span>description<span class="op">)</span> <span class="at">const</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// UI エディタの右下からドラッグ &amp; ドロップしたときに作成されるインスタンスを設定。</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> WaveView<span class="op">(</span>CRect<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">50</span><span class="op">));</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> apply<span class="op">(</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    CView <span class="op">*</span>view<span class="op">,</span> <span class="at">const</span> UIAttributes <span class="op">&amp;</span>attributes<span class="op">,</span> <span class="at">const</span> IUIDescription <span class="op">*</span>description<span class="op">)</span> <span class="at">const</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// uidesc から読み込んだパラメータを適用。</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ここでは位置、大きさ、 sub-controller だけを設定。</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// vstgui4/vstgui/uidescription/uiviewcreator.cpp の CViewCreator からコピーしてきた。</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> waveView <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>WaveView <span class="op">*&gt;(</span>view<span class="op">);</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>waveView <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>    CPoint point<span class="op">;</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>    CRect size<span class="op">;</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>attributes<span class="op">.</span>getPointAttribute<span class="op">(</span>kAttrOrigin<span class="op">,</span> point<span class="op">))</span> <span class="op">{</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>      <span class="kw">auto</span> viewSize <span class="op">=</span> waveView<span class="op">-&gt;</span>getViewSize<span class="op">();</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>      size<span class="op">.</span>setTopLeft<span class="op">(</span>point<span class="op">);</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>      size<span class="op">.</span>setWidth<span class="op">(</span>viewSize<span class="op">.</span>getWidth<span class="op">());</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>      size<span class="op">.</span>setHeight<span class="op">(</span>viewSize<span class="op">.</span>getHeight<span class="op">());</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>      waveView<span class="op">-&gt;</span>setViewSize<span class="op">(</span>size<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>      waveView<span class="op">-&gt;</span>setMouseableArea<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>attributes<span class="op">.</span>getPointAttribute<span class="op">(</span>kAttrSize<span class="op">,</span> point<span class="op">))</span> <span class="op">{</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>      size <span class="op">=</span> waveView<span class="op">-&gt;</span>getViewSize<span class="op">();</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>      size<span class="op">.</span>setSize<span class="op">(</span>point<span class="op">);</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>      waveView<span class="op">-&gt;</span>setViewSize<span class="op">(</span>size<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>      waveView<span class="op">-&gt;</span>setMouseableArea<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="kw">auto</span> subControllerAttr <span class="op">=</span> attributes<span class="op">.</span>getAttributeValue<span class="op">(</span>kAttrSubController<span class="op">);</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>subControllerAttr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>      view<span class="op">-&gt;</span>setAttribute<span class="op">(</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>        <span class="ch">&#39;u</span><span class="er">isc</span><span class="ch">&#39;</span><span class="op">,</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>        <span class="kw">static_cast</span><span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;(</span>subControllerAttr<span class="op">-&gt;</span>size<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">),</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>        subControllerAttr<span class="op">-&gt;</span>c_str<span class="op">());</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> getAttributeNames<span class="op">(</span><span class="bu">std::</span>list<span class="op">&lt;</span><span class="bu">std::</span>string<span class="op">&gt;</span> <span class="op">&amp;</span>attributeNames<span class="op">)</span> <span class="at">const</span></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">// uidesc に書き込まれる属性の名前を設定。</span></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">// kAttr* は vstgui4\vstgui\uidescription\detail\uiviewcreatorattributes.h を参照。</span></span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>    attributeNames<span class="op">.</span>emplace_back<span class="op">(</span>kAttrOrigin<span class="op">);</span></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>    attributeNames<span class="op">.</span>emplace_back<span class="op">(</span>kAttrSize<span class="op">);</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>    attributeNames<span class="op">.</span>emplace_back<span class="op">(</span>kAttrSubController<span class="op">);</span></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>  IViewCreator<span class="op">::</span>AttrType getAttributeType<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string <span class="op">&amp;</span>attributeName<span class="op">)</span> <span class="at">const</span></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">// uidesc の属性を C++ で受け取るときの型を設定。</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>attributeName <span class="op">==</span> kAttrOrigin<span class="op">)</span></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> kPointType<span class="op">;</span></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>attributeName <span class="op">==</span> kAttrSize<span class="op">)</span></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> kPointType<span class="op">;</span></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>attributeName <span class="op">==</span> kAttrSubController<span class="op">)</span></span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> kStringType<span class="op">;</span></span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kUnknownType<span class="op">;</span></span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> getAttributeValue<span class="op">(</span></span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>    CView <span class="op">*</span>view<span class="op">,</span></span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="bu">std::</span>string <span class="op">&amp;</span>attributeName<span class="op">,</span></span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="op">&amp;</span>stringValue<span class="op">,</span></span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> IUIDescription <span class="op">*</span>desc<span class="op">)</span> <span class="at">const</span></span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">// UI エディタで設定された属性を uidesc に書き込む文字列に変換。</span></span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>attributeName <span class="op">==</span> kAttrOrigin<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>      stringValue <span class="op">=</span> UIAttributes<span class="op">::</span>pointToString<span class="op">(</span>view<span class="op">-&gt;</span>getViewSize<span class="op">().</span>getTopLeft<span class="op">());</span></span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>attributeName <span class="op">==</span> kAttrSize<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>      stringValue <span class="op">=</span> UIAttributes<span class="op">::</span>pointToString<span class="op">(</span>view<span class="op">-&gt;</span>getViewSize<span class="op">().</span>getSize<span class="op">());</span></span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>attributeName <span class="op">==</span> kAttrSubController<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> getViewAttributeString<span class="op">(</span>view<span class="op">,</span> <span class="ch">&#39;u</span><span class="er">isc</span><span class="ch">&#39;</span><span class="op">,</span> stringValue<span class="op">);</span></span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">bool</span></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>  getViewAttributeString<span class="op">(</span>CView <span class="op">*</span>view<span class="op">,</span> <span class="at">const</span> CViewAttributeID attrID<span class="op">,</span> <span class="bu">std::</span>string <span class="op">&amp;</span>value<span class="op">)</span></span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> attrSize <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>view<span class="op">-&gt;</span>getAttributeSize<span class="op">(</span>attrID<span class="op">,</span> attrSize<span class="op">))</span> <span class="op">{</span></span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>      <span class="dt">char</span> <span class="op">*</span>cstr <span class="op">=</span> <span class="kw">new</span> <span class="dt">char</span><span class="op">[</span>attrSize <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>view<span class="op">-&gt;</span>getAttribute<span class="op">(</span>attrID<span class="op">,</span> attrSize<span class="op">,</span> cstr<span class="op">,</span> attrSize<span class="op">))</span></span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> cstr<span class="op">;</span></span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span></span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>      <span class="kw">delete</span><span class="op">[]</span> cstr<span class="op">;</span></span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>WaveViewCreator __gWaveViewCreator<span class="op">;</span></span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace UIViewCreator</span></span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace VSTGUI</span></span></code></pre></div>
  <div class="sourceCode" id="cb37"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="er">`SomeFX/CMakeLists.txt` にファイルを追加します。</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="er">```cmake</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(plug_sources</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    source/plugcontroller.hpp</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    source/plugids.hpp</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    source/plugprocessor.hpp</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    source/version.hpp</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    source/plugfactory.cpp</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    source/plugcontroller.cpp</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    source/plugprocessor.cpp</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    source/gui/waveview.hpp        <span class="co"># 追加</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    source/gui/waveview.cpp        <span class="co"># 追加</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    source/gui/waveviewcreator.cpp <span class="co"># 追加</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
  <ul>
  <li><code>vstgui4/vstgui/Documentation/html/md_page_create_your_own_ui_view.html</code></li>
  <li><code>vstgui4/vstgui/Documentation/html/class_v_s_t_g_u_i_1_1_i_view_creator.html</code></li>
  <li><code>vstgui4/vstgui/uidescription/uiattributes.h</code></li>
  <li><code>vstgui4/vstgui/uidescription/detail/uiviewcreatorattributes.h</code></li>
  </ul>
  <h4 id="パラメータの連動"><a href="#パラメータの連動"
  class="header-anchor" aria-hidden="true">パラメータの連動</a></h4>
  <ul>
  <li>TODO 検証</li>
  </ul>
  <p>ここに書いてある内容は手持ちの DAW
  では動かなかったので検証できていません。同じ仕組みを使っている
  noteexpressionsynth のキーボード UI もうまく動いていなかったので、 DAW
  側で実装されていない可能性が高いと判断して掲載しています。</p>
  <p>UI エディタで、パラメータを受け取る側のビューの sub-controller
  に適当な文字列を設定します。ここでは <code>WaveViewController</code>
  としています。</p>
  <p>コントロールクラスに <code>VST3EditorDelegate</code> を継承させて
  <code>createSubController</code> を実装します。
  <code>SomeFX/source/plugcontroller.hpp</code>
  でメソッドを追加します。</p>
  <div class="sourceCode" id="cb38"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugController <span class="op">:</span> <span class="kw">public</span> Vst<span class="op">::</span>EditController<span class="op">,</span> <span class="kw">public</span> VSTGUI<span class="op">::</span>VST3EditorDelegate <span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  VSTGUI<span class="op">::</span>IController <span class="op">*</span>createSubController<span class="op">(</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    VSTGUI<span class="op">::</span>UTF8StringPtr name<span class="op">,</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> VSTGUI<span class="op">::</span>IUIDescription <span class="op">*</span>description<span class="op">,</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    VSTGUI<span class="op">::</span>VST3Editor <span class="op">*</span>editor<span class="op">)</span> SMTG_OVERRIDE<span class="op">;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>SomeFX/source/plugcontroller.cpp</code>
  に実装を追加します。</p>
  <div class="sourceCode" id="cb39"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WaveViewController <span class="op">:</span> <span class="kw">public</span> DelegationController <span class="op">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  WaveViewController<span class="op">(</span>IController <span class="op">*</span>controller<span class="op">)</span> <span class="op">:</span> DelegationController<span class="op">(</span>controller<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">~</span>WaveViewController<span class="op">()</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>waveview <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span> waveview<span class="op">-&gt;</span>forget<span class="op">();</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  CView <span class="op">*</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  verifyView<span class="op">(</span>CView <span class="op">*</span>view<span class="op">,</span> <span class="at">const</span> UIAttributes <span class="op">&amp;</span>attributes<span class="op">,</span> IUIDescription <span class="op">*</span>description<span class="op">)</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> control <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>WaveView <span class="op">*&gt;(</span>view<span class="op">);</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>control <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="op">{</span> <span class="co">// 必要に応じてタグのチェックを追加する。</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>      waveview <span class="op">=</span> control<span class="op">;</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>      waveview<span class="op">-&gt;</span>remember<span class="op">();</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> controller<span class="op">-&gt;</span>verifyView<span class="op">(</span>view<span class="op">,</span> attributes<span class="op">,</span> description<span class="op">);</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> valueChanged<span class="op">(</span>CControl <span class="op">*</span>pControl<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 多分 DAW がこのメソッドの呼び出しを実装していない。</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reaper 5.980 と FL Studio 20.5 では動かなかった。</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    Vst<span class="op">::</span>ParamID tag <span class="op">=</span> pControl<span class="op">-&gt;</span>getTag<span class="op">();</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>waveview <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>tag <span class="op">==</span> ParameterID<span class="op">::</span>volume<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>      waveview<span class="op">-&gt;</span>gain <span class="op">=</span> pControl<span class="op">-&gt;</span>getValueNormalized<span class="op">();</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>      waveview<span class="op">-&gt;</span>setDirty<span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  WaveView <span class="op">*</span>waveview <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>IController <span class="op">*</span>PlugController<span class="op">::</span>createSubController<span class="op">(</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  UTF8StringPtr name<span class="op">,</span> <span class="at">const</span> IUIDescription <span class="op">*</span>description<span class="op">,</span> VST3Editor <span class="op">*</span>editor<span class="op">)</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>name <span class="op">==</span> <span class="st">&quot;WaveViewController&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> WaveViewController<span class="op">(</span>editor<span class="op">);</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>これで動くはずですが、コメントで書いたように
  <code>DelegationController</code> の <code>valueChanged</code>
  がホストから呼び出されていないようです。ドキュメンテーションの
  <code>vstgui4/vstgui/Documentation/html/page_uidescription_editor.html</code>
  では <code>DelegationController</code> の <code>notify</code>
  を使っていますが、 <code>CControl::kMessageValueChanged</code> は
  VSTGUI 4.8 で廃止されたので動きません。</p>
  <ul>
  <li><code>vstgui4/vstgui/Documentation/html/page_uidescription_editor.html</code></li>
  <li><code>vstgui4/vstgui/Documentation/html/page_news_and_changes.html</code></li>
  </ul>
  <h3 id="コードでgui"><a href="#コードでgui" class="header-anchor"
  aria-hidden="true">コードでGUI</a></h3>
  <p><code>VSTGUIEditor</code> をベースにしてコードでGUIを作ります。</p>
  <p><code>VSTGUIEditor</code> を使った GUI
  の作成についてはうつぼかずらさんによる<a
  href="https://www.utsbox.com/">C++でVST作り</a>が参考になります。ここではC++でVST作りで紹介されていない内容について扱っています。</p>
  <ul>
  <li><a href="https://www.utsbox.com/">C++でVST作り</a></li>
  </ul>
  <h4 id="カスタムフォント"><a href="#カスタムフォント"
  class="header-anchor" aria-hidden="true">カスタムフォント</a></h4>
  <p>VSTGUI でカスタムフォントを使うにはプラグインバンドルの
  <code>Contents/Resources/Fonts</code> に <code>*.ttf</code>
  ファイルを配置します。</p>
  <p>プラグインの <code>CMakeLists.txt</code> に以下の行を追加します。
  <code>${target}</code>
  はプラグイン名あるいはプロジェクト名です。ライセンスファイルもまとめて同梱しています。</p>
  <div class="sourceCode" id="cb40"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">smtg_add_plugin_resource</span>(<span class="dv">${target}</span> <span class="st">&quot;../common/resource/Fonts/Tinos-BoldItalic.ttf&quot;</span> <span class="st">&quot;Fonts&quot;</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">smtg_add_plugin_resource</span>(<span class="dv">${target}</span> <span class="st">&quot;../common/resource/Fonts/LICENSE.txt&quot;</span> <span class="st">&quot;Fonts&quot;</span>)</span></code></pre></div>
  <p>コード側では <code>CFontDesc</code>
  でフォントファミリの文字列とスタイルを指定すれば使えます。</p>
  <div class="sourceCode" id="cb41"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>SharedPointer<span class="op">&lt;</span>CFontDesc<span class="op">&gt;</span> font <span class="op">=</span> <span class="kw">new</span> CFontDesc<span class="op">(</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Tinos&quot;</span><span class="op">,</span>                                    <span class="co">// フォントファミリ名。</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">10.0</span><span class="op">,</span>                                       <span class="co">// サイズ。</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  CTxtFace<span class="op">::</span>kBoldFace <span class="op">|</span> CTxtFace<span class="op">::</span>kItalicFace <span class="co">// スタイル。</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code></pre></div>
  <p>太字とイタリックは使えました。 Noto フォントなどが提供している demi
  light
  などのより細かい文字の太さが使えるかどうかは確認していません。</p>
  <p>フォントファミリ名あるいはスタイルの指定が正しくないときは VSTGUI
  が設定した <code>kSystemFont</code> がデフォルトとして使われます。
  macOS では 12 ポイントの <code>Helvetica</code> 、 それ以外の OS では
  12 ポイントの <code>Arial</code> がデフォルトです。詳細は
  <code>vst3sdk/vstgui4/vstgui/lib/cfont.cpp</code>
  を参照してみてください。</p>
  <h4 id="ホストのオートメーションに応じて表示を更新"><a
  href="#ホストのオートメーションに応じて表示を更新"
  class="header-anchor"
  aria-hidden="true">ホストのオートメーションに応じて表示を更新</a></h4>
  <p>ホストがオートメーションによってパラメータを変更したときは
  <code>EditController.setParamNormalized()</code>
  に変更された値が渡されます。 <code>setParamNormalized()</code>
  をオーバーライドして GUI に値を渡すことができます。</p>
  <ol type="1">
  <li><code>VSTGUIEditor</code> を継承したエディタクラスに ID
  と値を受け取って <code>CControl</code>
  などの要素を更新するメソッドを作る。</li>
  <li><code>EditController</code>
  を継承したコントローラクラスにエディタクラスのポインタを持たせる。</li>
  <li><code>setParamNormalized()</code>
  をオーバーライドしてエディタクラスのポインタから GUI に値を渡す。</li>
  </ol>
  <ul>
  <li><p>TODO 実装の追加</p></li>
  <li><p><a
  href="https://steinbergmedia.github.io/vst3_dev_portal/pages/Technical+Documentation/Parameters+Automation/Index.html">Parameters
  and Automation - VST 3 Developer Portal</a></p></li>
  <li><p><a
  href="https://sdk.steinberg.net/viewtopic.php?f=4&amp;t=714">Clarification
  of parameter handling in VST 3 - sdk.steinberg.net</a></p></li>
  </ul>
  <h4 id="リフレッシュレートの設定"><a href="#リフレッシュレートの設定"
  class="header-anchor"
  aria-hidden="true">リフレッシュレートの設定</a></h4>
  <p><code>VSTGUIEditor</code> の <code>setIdleRate</code>
  でリフレッシュレートを変更できます。指定する値の単位は ms (ミリ秒)
  で、デフォルト値は 100ms (10Hz)
  です。カスタムビューの更新が遅く感じるときなどに変更してみてください。</p>
  <div class="sourceCode" id="cb42"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> PlugEditor<span class="op">::</span>open<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>parent<span class="op">,</span> <span class="at">const</span> PlatformType <span class="op">&amp;</span>platformType<span class="op">)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  setIdleRate<span class="op">(</span><span class="dv">1000</span> <span class="op">/</span> <span class="dv">60</span><span class="op">);</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <ul>
  <li><code>public.sdk/source/vst/vstguieditor.cpp</code></li>
  <li><code>vstgui4/vstgui/lib/cvstguitimer.h</code></li>
  </ul>
  <h4 id="キーボードイベントの受け取り"><a
  href="#キーボードイベントの受け取り" class="header-anchor"
  aria-hidden="true">キーボードイベントの受け取り</a></h4>
  <p>キーボードイベントは <code>CView::onKeyboardEvent()</code>
  をオーバーライドして受け取ります。 <code>onKeyboardEvent</code>
  が呼ばれるためにはビューがフォーカスを取る必要があります。</p>
  <p><code>CControl</code> を継承したクラスでは
  <code>setWantsFocus(true)</code>
  をコンストラクタで呼ぶだけで、マウスクリックなどでフォーカスが取れるようになります。</p>
  <div class="sourceCode" id="cb43"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> SomeControl <span class="op">:</span> <span class="kw">public</span> CControl <span class="op">{</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">explicit</span> SomeControl<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">)</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> CControl<span class="op">(</span>size<span class="op">)</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    setWantsFocus<span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// 継承元が CControl ならこれで十分。</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onKeyboardEvent<span class="op">(</span>KeyboardEvent <span class="op">&amp;</span>event<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ここでキーボードイベントをハンドル。</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>CControl</code> を継承したクラスは <kbd>Ctrl</kbd> +
  <kbd>左クリック</kbd>
  のイベントが奪われてしまうという問題があります。この問題を避けるためには
  <code>CView</code> が使えます。</p>
  <p><code>CView</code>
  を継承したクラスではフォーカスを明示的に取る必要があります。フォーカスを取るには
  <code>CFrame::setFocusView()</code> が使えます。 <code>CFrame</code>
  は <code>VSTGUIEditor::getFrame()</code> から取得できます。</p>
  <div class="sourceCode" id="cb44"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> SomeView <span class="op">:</span> <span class="kw">public</span> CView <span class="op">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// VSTGUIEditor::getFrame() を使うので editor としてコンストラクタで受け取る。</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  Steinberg<span class="op">::</span>Vst<span class="op">::</span>VSTGUIEditor <span class="op">*</span>editor <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">explicit</span> SomeView<span class="op">(</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    Steinberg<span class="op">::</span>Vst<span class="op">::</span>VSTGUIEditor <span class="op">*</span>editor<span class="op">,</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">)</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> CView<span class="op">(</span>size<span class="op">),</span> editor<span class="op">(</span>editor<span class="op">)</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    setTransparency<span class="op">(</span><span class="kw">false</span><span class="op">);</span> <span class="co">// CControl のコンストラクタからコピーした。なくてもいい。</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    setMouseEnabled<span class="op">(</span><span class="kw">true</span><span class="op">);</span>  <span class="co">// CControl のコンストラクタからコピーした。必要。</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    setWantsFocus<span class="op">(</span><span class="kw">true</span><span class="op">);</span>    <span class="co">// 継承元が CControl ならこれで十分。 CView ではこれだけでは不足。</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>editor <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span> editor<span class="op">-&gt;</span>addRef<span class="op">();</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">virtual</span> <span class="op">~</span>SomeView<span class="op">()</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>editor <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span> editor<span class="op">-&gt;</span>release<span class="op">();</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> grabFocus<span class="op">()</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>editor<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>editor<span class="op">-&gt;</span>getFrame<span class="op">())</span> editor<span class="op">-&gt;</span>getFrame<span class="op">()-&gt;</span>setFocusView<span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> releaseFocus<span class="op">()</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>editor<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>editor<span class="op">-&gt;</span>getFrame<span class="op">())</span> editor<span class="op">-&gt;</span>getFrame<span class="op">()-&gt;</span>setFocusView<span class="op">(</span><span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onMouseEnterEvent<span class="op">(</span>MouseEnterEvent <span class="op">&amp;</span>event<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    grabFocus<span class="op">();</span> <span class="co">// マウスが SomeView の領域に入るとフォーカスを取る。</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    event<span class="op">.</span>consumed <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onMouseExitEvent<span class="op">(</span>MouseExitEvent <span class="op">&amp;</span>event<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>    releaseFocus<span class="op">();</span> <span class="co">// マウスが SomeView の領域から出るとフォーカスを外す。</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>    event<span class="op">.</span>consumed <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onKeyboardEvent<span class="op">(</span>KeyboardEvent <span class="op">&amp;</span>event<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ここでキーボードイベントをハンドル。</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p>以下は公式ドキュメンテーションへのリンクです。キーボードイベントを受け取る条件については書いてありますが、どうすればその条件を満たせるのか
  (どう実装すればいいのか)
  について書いていないので、あまり役には立ちません。</p>
  <ul>
  <li><a
  href="https://steinbergmedia.github.io/vst3_doc/vstgui/html/key_event_flow.html">VSTGUI:
  Keyboard Event Flow</a></li>
  </ul>
  <h4 id="カスタムビューの実装と関連するコントロールの表示の変更"><a
  href="#カスタムビューの実装と関連するコントロールの表示の変更"
  class="header-anchor"
  aria-hidden="true">カスタムビューの実装と関連するコントロールの表示の変更</a></h4>
  <p>あるコントロールの値を変更したときに、連動して別のコントロールの値や表示を変更したい時があります。ここでは例としてコントロールの値に応じてカスタムビューで波形を表示するようにします。</p>
  <p>カスタムビューは <code>CView</code>
  を継承したクラスならどれを継承しても作ることができます。例えばスライダーの見た目を変更したいなら
  <code>CSlider</code>
  を継承する、テキストを表示するカスタムビューを作りたいときは
  <code>CParamDisplay</code>
  を継承するといった形で実装の手間を減らせるときがあります。継承して使えるクラスを探すときは
  <code>vstgui4/vstgui/lib</code> と
  <code>vstgui4/vstgui/lib/controls</code> を覗いてみてください。</p>
  <p>ここでは波形を表示するだけなので <code>CControl</code> を継承して
  <code>draw</code> をオーバーライドしただけの <code>WaveView</code>
  というカスタムビューを作ります。 <code>waveview.hpp</code>
  の内容です。</p>
  <div class="sourceCode" id="cb45"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui/vstgui.h&quot;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> VSTGUI <span class="op">{</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WaveView <span class="op">:</span> <span class="kw">public</span> CControl <span class="op">{</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  WaveView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">);</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> draw<span class="op">(</span>CDrawContext <span class="op">*</span>pContext<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  CLASS_METHODS<span class="op">(</span>WaveView<span class="op">,</span> CControl<span class="op">);</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> lfo<span class="op">(</span><span class="dt">double</span> phase<span class="op">);</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> amount <span class="op">=</span> <span class="fl">0.9</span><span class="op">;</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> shape <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> phase <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  CLineStyle lineStyle<span class="op">{</span>CLineStyle<span class="op">::</span>kLineCapRound<span class="op">,</span> CLineStyle<span class="op">::</span>kLineJoinRound<span class="op">};</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  CDrawContext<span class="op">::</span>PointList points<span class="op">;</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace VSTGUI</span></span></code></pre></div>
  <p><code>waveview.cpp</code>
  の内容です。ここでは描画する波形が簡単なので
  <code>WaveView::lfo</code> として GUI
  側で実装しています。コードがより複雑になるときは GUI
  側に波形を生成するコードを書かずに、プロセッサクラスから信号処理の部分をヘッダにまとめてインクルードすることをお勧めします。</p>
  <ul>
  <li>TODO</li>
  </ul>
  <div class="sourceCode" id="cb46"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;waveview.hpp&quot;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> VSTGUI <span class="op">{</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>WaveView<span class="op">::</span>WaveView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">)</span> <span class="op">:</span> CControl<span class="op">(</span>size<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> WaveView<span class="op">::</span>draw<span class="op">(</span>CDrawContext <span class="op">*</span>pContext<span class="op">)</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// アンチエイリアスを有効にする。</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setDrawMode<span class="op">(</span>CDrawMode<span class="op">(</span>CDrawModeFlags<span class="op">::</span>kAntiAliasing<span class="op">));</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 座標変換して (x, y) = (0, 0) がビューの左上となるようにする。</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 座標変換しないときの (0, 0) はプラグインウィンドウの左上になる。</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  CDrawContext<span class="op">::</span>Transform t<span class="op">(</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>pContext<span class="op">,</span> CGraphicsTransform<span class="op">().</span>translate<span class="op">(</span>getViewSize<span class="op">().</span>getTopLeft<span class="op">()));</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> width <span class="op">=</span> getWidth<span class="op">();</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> height <span class="op">=</span> getHeight<span class="op">();</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> borderWidth <span class="op">=</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> halfBorderWidth <span class="op">=</span> borderWidth <span class="op">/</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background.</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineWidth<span class="op">(</span>borderWidth<span class="op">);</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFillColor<span class="op">(</span>pal<span class="op">.</span>background<span class="op">());</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawRect<span class="op">(</span>CRect<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">),</span> kDrawFilled<span class="op">);</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Waveform.</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineWidth<span class="op">(</span><span class="fl">2.0</span><span class="op">);</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineStyle<span class="op">(</span>lineStyle<span class="op">);</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFrameColor<span class="op">(</span>CColor<span class="op">(</span><span class="dv">19</span><span class="op">,</span> <span class="dv">193</span><span class="op">,</span> <span class="dv">54</span><span class="op">,</span> <span class="dv">255</span><span class="op">));</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">size_t</span> size <span class="op">=</span> <span class="op">(</span><span class="dt">size_t</span><span class="op">)(</span>width <span class="op">+</span> <span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>points<span class="op">.</span>size<span class="op">()</span> <span class="op">!=</span> size<span class="op">)</span> points<span class="op">.</span>resize<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x <span class="op">&lt;</span> points<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>x<span class="op">)</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    points<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> CPoint<span class="op">((</span>CCoord<span class="op">)</span>x<span class="op">,</span> height <span class="op">*</span> lfo<span class="op">(</span>x <span class="op">/</span> width<span class="op">));</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawPolygon<span class="op">(</span>points<span class="op">);</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Always draw border at last. Otherwise, inner object will be drawn over border.</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFrameColor<span class="op">(</span>isMouseEntered <span class="op">?</span> pal<span class="op">.</span>highlightMain<span class="op">()</span> <span class="op">:</span> pal<span class="op">.</span>border<span class="op">());</span></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawRect<span class="op">(</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>    CRect<span class="op">(</span>halfBorderWidth<span class="op">,</span> halfBorderWidth<span class="op">,</span> width<span class="op">,</span> height<span class="op">),</span> kDrawStroked<span class="op">);</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>  setDirty<span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> WaveView<span class="op">::</span>lfo<span class="op">(</span><span class="dt">double</span> phase<span class="op">)</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> pi <span class="op">=</span> <span class="fl">3.14159265358979323846</span><span class="op">;</span></span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>  phase <span class="op">=</span> <span class="kw">this</span><span class="op">-&gt;</span>phase <span class="op">+</span> phase <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> pi<span class="op">;</span></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">*</span> pi<span class="op">)</span> phase <span class="op">-=</span> <span class="dv">2</span> <span class="op">*</span> pi<span class="op">;</span></span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> sign <span class="op">=</span> <span class="op">(</span>pi <span class="op">&lt;</span> phase<span class="op">)</span> <span class="op">-</span> <span class="op">(</span>phase <span class="op">&lt;</span> pi<span class="op">);</span></span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> wave <span class="op">=</span> amount <span class="op">*</span> sign <span class="op">*</span> pow<span class="op">(</span>fabs<span class="op">(</span>sin<span class="op">(</span>phase<span class="op">)),</span> shape<span class="op">);</span></span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">(</span>wave <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace VSTGUI</span></span></code></pre></div>
  <p>エディタクラスに関数を追加します。</p>
  <div class="sourceCode" id="cb47"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugEditor <span class="op">:</span> <span class="kw">public</span> VSTGUIEditor<span class="op">,</span> <span class="kw">public</span> IControlListener <span class="op">{</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> addWaveView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">);</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  ParamValue getPlainValue<span class="op">(</span>ParamID tag<span class="op">);</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> CRect WaveViewSize<span class="op">{</span><span class="fl">100.0</span><span class="op">,</span> <span class="fl">100.0</span><span class="op">,</span> <span class="fl">200.0</span><span class="op">,</span> <span class="fl">200.0</span><span class="op">};</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// getViewAt が反応するように 1 ピクセル内側を指定する。</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> CPoint WaveViewPos<span class="op">{</span>WaveViewSize<span class="op">.</span>left <span class="op">+</span> <span class="fl">1.0</span><span class="op">,</span> WaveViewSize<span class="op">.</span>top <span class="op">+</span> <span class="fl">1.0</span><span class="op">};</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>addWaveView</code> の実装です。 <code>parameter.hpp</code>
  で定義したパラメータIDを使ってコントローラから初期値を取得しています。</p>
  <div class="sourceCode" id="cb48"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;parameter.hpp&quot;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> PlugEditor<span class="op">::</span>addWaveView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> view <span class="op">=</span> <span class="kw">new</span> WaveView<span class="op">(</span>size<span class="op">);</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  view<span class="op">-&gt;</span>shape <span class="op">=</span> getPlainValue<span class="op">(</span>SomePlugin<span class="op">::</span>ParameterID<span class="op">::</span>lfoShape<span class="op">);</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  view<span class="op">-&gt;</span>phase <span class="op">=</span> getPlainValue<span class="op">(</span>SomePlugin<span class="op">::</span>ParameterID<span class="op">::</span>lfoInitialPhase<span class="op">);</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  frame<span class="op">-&gt;</span>addView<span class="op">(</span>view<span class="op">);</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>ParamValue PlugEditor<span class="op">::</span>getPlainValue<span class="op">(</span>ParamID tag<span class="op">)</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> normalized <span class="op">=</span> controller<span class="op">-&gt;</span>getParamNormalized<span class="op">(</span>tag<span class="op">);</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> controller<span class="op">-&gt;</span>normalizedParamToPlain<span class="op">(</span>tag<span class="op">,</span> normalized<span class="op">);</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>open</code> で <code>WaveView</code> を作成します。</p>
  <div class="sourceCode" id="cb49"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> PlugEditor<span class="op">::</span>open<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>parent<span class="op">,</span> <span class="at">const</span> PlatformType <span class="op">&amp;</span>platformType<span class="op">)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  addWaveView<span class="op">(</span>WaveViewSize<span class="op">);</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>エディタクラスの <code>valueChanged</code>
  で関連するコントロールの変更を検知して <code>WaveView</code>
  を更新します。ここでは <code>VSTGUIEditor::open</code>
  で作成したコントロールを取得するために <code>getViewAt</code>
  を使っています。 <code>getViewAt</code> に渡している
  <code>WaveViewPos</code> はエディタクラスのメンバとして定義した
  <code>WaveView</code> の位置です。</p>
  <div class="sourceCode" id="cb50"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> PlugEditor<span class="op">::</span>valueChanged<span class="op">(</span>CControl <span class="op">*</span>pControl<span class="op">)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  ParamID tag <span class="op">=</span> pControl<span class="op">-&gt;</span>getTag<span class="op">();</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  ParamValue value <span class="op">=</span> pControl<span class="op">-&gt;</span>getValueNormalized<span class="op">();</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  controller<span class="op">-&gt;</span>setParamNormalized<span class="op">(</span>tag<span class="op">,</span> value<span class="op">);</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  controller<span class="op">-&gt;</span>performEdit<span class="op">(</span>tag<span class="op">,</span> value<span class="op">);</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>tag <span class="op">==</span> SevenDelay<span class="op">::</span>ParameterID<span class="op">::</span>lfoShape<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> some <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>WaveView <span class="op">*&gt;(</span>frame<span class="op">-&gt;</span>getViewAt<span class="op">(</span>WaveViewPos<span class="op">));</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>some <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    some<span class="op">-&gt;</span>shape <span class="op">=</span> getPlainValue<span class="op">(</span>tag<span class="op">);</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    some<span class="op">-&gt;</span>setDirty<span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>tag <span class="op">==</span> SevenDelay<span class="op">::</span>ParameterID<span class="op">::</span>lfoInitialPhase<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> some <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>WaveView <span class="op">*&gt;(</span>frame<span class="op">-&gt;</span>getViewAt<span class="op">(</span>WaveViewPos<span class="op">));</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>some <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    some<span class="op">-&gt;</span>phase <span class="op">=</span> getPlainValue<span class="op">(</span>tag<span class="op">);</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    some<span class="op">-&gt;</span>setDirty<span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>コントロールを取得する別の方法としては
  <code>frame-&gt;getView</code> があります。引数の <code>index</code>
  がどういう値なのかドキュメンテーションに書いていなかったのでここでは使っていません。興味のある方は
  <code>vstgui4/vstgui/lib/cviewcontainer.*</code>
  を読んでみてください。</p>
  <h4 id="スプラッシュスクリーンの追加"><a
  href="#スプラッシュスクリーンの追加" class="header-anchor"
  aria-hidden="true">スプラッシュスクリーンの追加</a></h4>
  <p><code>CSplashScreen</code>
  でスプラッシュスクリーンを作成できます。</p>
  <p>エディタクラスにスプラッシュスクリーンを追加する関数を作ります。</p>
  <div class="sourceCode" id="cb51"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugEditor <span class="op">:</span> <span class="kw">public</span> VSTGUIEditor<span class="op">,</span> <span class="kw">public</span> IControlListener <span class="op">{</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> addSplashScreen<span class="op">(</span>CRect <span class="op">&amp;</span>buttonRect<span class="op">,</span> CRect splashRect<span class="op">);</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>addSplashScreen</code>
  の実装です。ここではスプラッシュスクリーンとしてカスタムビューの
  <code>CreditView</code>
  が表示されるようにしています。開いたスプラッシュスクリーンをクリックしたときに閉じるようにするにはカスタムビュー側の
  <code>setListener</code> に <code>CSplashScreen</code>
  を渡しておく必要があります。 <code>setListener</code> は
  <code>CControl</code> で実装されています。</p>
  <div class="sourceCode" id="cb52"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> PlugEditor<span class="op">::</span>addSplashScreen<span class="op">(</span>CRect <span class="op">&amp;</span>buttonRect<span class="op">,</span> CRect splashRect<span class="op">)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> credit <span class="op">=</span> <span class="kw">new</span> CreditView<span class="op">(</span>splashRect<span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> splash <span class="op">=</span> <span class="kw">new</span> CSplashScreen<span class="op">(</span>buttonRect<span class="op">,</span> <span class="kw">this</span><span class="op">,</span> <span class="op">-</span><span class="dv">666</span><span class="op">,</span> credit<span class="op">);</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  credit<span class="op">-&gt;</span>setListener<span class="op">(</span>splash<span class="op">);</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  frame<span class="op">-&gt;</span>addView<span class="op">(</span>splash<span class="op">);</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p><code>open</code> でスプラッシュスクリーンを追加します。</p>
  <div class="sourceCode" id="cb53"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> PlugEditor<span class="op">::</span>open<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>parent<span class="op">,</span> <span class="at">const</span> PlatformType <span class="op">&amp;</span>platformType<span class="op">)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// viewRect はウィンドウの大きさ。</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  addSplashScreen<span class="op">(</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    CRect<span class="op">(</span><span class="fl">30.0</span><span class="op">,</span> <span class="fl">340.0</span><span class="op">,</span> <span class="fl">190.0</span><span class="op">,</span> <span class="fl">380.0</span><span class="op">),</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    CRect<span class="op">(</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>      viewRect<span class="op">.</span>left <span class="op">+</span> <span class="fl">200.0</span><span class="op">,</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>      viewRect<span class="op">.</span>top <span class="op">+</span> <span class="fl">20.0</span><span class="op">,</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>      viewRect<span class="op">.</span>right <span class="op">-</span> <span class="fl">200.0</span><span class="op">,</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>      viewRect<span class="op">.</span>bottom <span class="op">-</span> <span class="fl">20.0</span><span class="op">));</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p><code>source/gui/splash.hpp</code> を作って <code>CreditView</code>
  を実装します。</p>
  <div class="sourceCode" id="cb54"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui/vstgui.h&quot;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> Steinberg <span class="op">{</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> Vst <span class="op">{</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> VSTGUI<span class="op">;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CreditView <span class="op">:</span> <span class="kw">public</span> CControl <span class="op">{</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  CreditView<span class="op">(</span><span class="at">const</span> CRect <span class="op">&amp;</span>size<span class="op">,</span> IControlListener <span class="op">*</span>listener<span class="op">)</span> <span class="op">:</span> CControl<span class="op">(</span>size<span class="op">,</span> listener<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> draw<span class="op">(</span>CDrawContext <span class="op">*</span>pContext<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onMouseDownEvent <span class="op">(</span>MouseDownEvent<span class="op">&amp;</span> event<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>event<span class="op">.</span>buttonState<span class="op">.</span>isLeft<span class="op">())</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    valueChanged<span class="op">();</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    event<span class="op">.</span>consumed <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    event<span class="op">.</span>ignoreFollowUpMoveAndUpEvents<span class="op">(</span><span class="kw">true</span><span class="op">);</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  CLASS_METHODS<span class="op">(</span>CreditView<span class="op">,</span> CControl<span class="op">)</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  UTF8String fontName<span class="op">{</span><span class="st">&quot;DejaVu Sans Mono&quot;</span><span class="op">};</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  CCoord fontSize <span class="op">=</span> <span class="fl">18.0</span><span class="op">;</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  CCoord fontSizeTitle <span class="op">=</span> <span class="fl">24.0</span><span class="op">;</span></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace Vst</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace Steinberg</span></span></code></pre></div>
  <p><code>source/gui/splash.cpp</code> を作ります。</p>
  <div class="sourceCode" id="cb55"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;splash.hpp&quot;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> Steinberg <span class="op">{</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> Vst <span class="op">{</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> VSTGUI<span class="op">;</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> CreditView<span class="op">::</span>draw<span class="op">(</span>CDrawContext <span class="op">*</span>pContext<span class="op">)</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setDrawMode<span class="op">(</span>CDrawMode<span class="op">(</span>CDrawModeFlags<span class="op">::</span>kAntiAliasing<span class="op">));</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  CDrawContext<span class="op">::</span>Transform t<span class="op">(</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>pContext<span class="op">,</span> CGraphicsTransform<span class="op">().</span>translate<span class="op">(</span>getViewSize<span class="op">().</span>getTopLeft<span class="op">()));</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> width <span class="op">=</span> getWidth<span class="op">();</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="kw">auto</span> height <span class="op">=</span> getHeight<span class="op">();</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> borderWidth <span class="op">=</span> <span class="fl">8.0</span><span class="op">;</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> halfBorderWidth <span class="op">=</span> borderWidth <span class="op">/</span> <span class="fl">2.0</span><span class="op">;</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background.</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setLineWidth<span class="op">(</span>borderWidth<span class="op">);</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFillColor<span class="op">(</span>pal<span class="op">.</span>background<span class="op">());</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawRect<span class="op">(</span>CRect<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">),</span> kDrawFilled<span class="op">);</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFont<span class="op">(</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> CFontDesc<span class="op">(</span>fontName<span class="op">,</span> fontSizeTitle<span class="op">,</span> CTxtFace<span class="op">::</span>kBoldFace <span class="op">|</span> CTxtFace<span class="op">::</span>kItalicFace<span class="op">));</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFontColor<span class="op">(</span>pal<span class="op">.</span>foreground<span class="op">());</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawString<span class="op">(</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    UTF8String<span class="op">(</span><span class="st">&quot;🐸🍻🐨🍻🐰&quot;</span><span class="op">).</span>getPlatformString<span class="op">(),</span> CPoint<span class="op">(</span><span class="fl">20.0</span><span class="op">,</span> <span class="fl">50.0</span><span class="op">));</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Border.</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>setFrameColor<span class="op">(</span>isMouseEntered <span class="op">?</span> pal<span class="op">.</span>highlightMain<span class="op">()</span> <span class="op">:</span> pal<span class="op">.</span>border<span class="op">());</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  pContext<span class="op">-&gt;</span>drawRect<span class="op">(</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>    CRect<span class="op">(</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>      halfBorderWidth<span class="op">,</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>      halfBorderWidth<span class="op">,</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>      width <span class="op">-</span> halfBorderWidth<span class="op">,</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>      height <span class="op">-</span> halfBorderWidth<span class="op">),</span></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>    kDrawStroked<span class="op">);</span></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  setDirty<span class="op">(</span><span class="kw">false</span><span class="op">);</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace Vst</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace Steinberg</span></span></code></pre></div>
  <p><code>SomeFX/CMakeLists.txt</code> にファイルを追加します。</p>
  <div class="sourceCode" id="cb56"><pre
  class="sourceCode cmake"><code class="sourceCode cmake"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span>(plug_sources</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    //...</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    source/gui/splash.hpp <span class="co"># 追加</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    source/gui/splash.cpp <span class="co"># 追加</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
  <h4 id="ホストが提供するコンテキストメニューの追加"><a
  href="#ホストが提供するコンテキストメニューの追加"
  class="header-anchor"
  aria-hidden="true">ホストが提供するコンテキストメニューの追加</a></h4>
  <p>エディタクラスに <code>IMouseObserver</code> を継承させます。</p>
  <div class="sourceCode" id="cb57"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugEditor <span class="op">:</span> <span class="kw">public</span> VSTGUIEditor<span class="op">,</span> <span class="kw">public</span> IControlListener<span class="op">,</span> <span class="kw">public</span> IMouseObserver <span class="op">{</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// IMouseObserver の実装。</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onMouseEntered<span class="op">(</span>CView <span class="op">*</span>view<span class="op">,</span> CFrame <span class="op">*</span>frame<span class="op">)</span> <span class="kw">override</span> <span class="op">{}</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> onMouseExited<span class="op">(</span>CView <span class="op">*</span>view<span class="op">,</span> CFrame <span class="op">*</span>frame<span class="op">)</span> <span class="kw">override</span> <span class="op">{}</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  CMouseEventResult</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  onMouseMoved<span class="op">(</span>CFrame <span class="op">*</span>frame<span class="op">,</span> <span class="at">const</span> CPoint <span class="op">&amp;</span>where<span class="op">,</span> <span class="at">const</span> CButtonState <span class="op">&amp;</span>buttons<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  CMouseEventResult</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  onMouseDown<span class="op">(</span>CFrame <span class="op">*</span>frame<span class="op">,</span> <span class="at">const</span> CPoint <span class="op">&amp;</span>where<span class="op">,</span> <span class="at">const</span> CButtonState <span class="op">&amp;</span>buttons<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p>エディタクラスの <code>open</code> メソッド内で <code>frame</code>
  からマウスイベントを伝えるように指定します。</p>
  <div class="sourceCode" id="cb58"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> PlugEditor<span class="op">::</span>open<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>parent<span class="op">,</span> <span class="at">const</span> PlatformType <span class="op">&amp;</span>platformType<span class="op">)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  frame<span class="op">-&gt;</span>registerMouseObserver<span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p><code>onMouseDown</code> を実装します。</p>
  <div class="sourceCode" id="cb59"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> PlugEditor<span class="op">::</span>onMouseEvent<span class="op">(</span>MouseEvent <span class="op">&amp;</span>event<span class="op">,</span> CFrame <span class="op">*</span>frame<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>event<span class="op">.</span>buttonState<span class="op">.</span>isRight<span class="op">())</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> componentHandler <span class="op">=</span> controller<span class="op">-&gt;</span>getComponentHandler<span class="op">();</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>componentHandler <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    FUnknownPtr<span class="op">&lt;</span>IComponentHandler3<span class="op">&gt;</span> handler<span class="op">(</span>componentHandler<span class="op">);</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>handler <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> control <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>CControl <span class="op">*&gt;(</span>frame<span class="op">-&gt;</span>getViewAt<span class="op">(</span>event<span class="op">.</span>mousePosition<span class="op">));</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>control <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Context menu will not popup when the control has negative tag.</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    ParamID id <span class="op">=</span> control<span class="op">-&gt;</span>getTag<span class="op">();</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>id <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">||</span> id <span class="op">&gt;=</span> LONG_MAX<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    IContextMenu <span class="op">*</span>menu <span class="op">=</span> handler<span class="op">-&gt;</span>createContextMenu<span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="op">&amp;</span>id<span class="op">);</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>menu <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    menu<span class="op">-&gt;</span>popup<span class="op">(</span>event<span class="op">.</span>mousePosition<span class="op">.</span>x<span class="op">,</span> event<span class="op">.</span>mousePosition<span class="op">.</span>y<span class="op">);</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    menu<span class="op">-&gt;</span>release<span class="op">();</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    event<span class="op">.</span>consumed <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span></code></pre></div>
  <p>0 あるいは負の tag
  が指定されたコントロールではコンテキストメニューを表示したくないので、
  <code>id</code> の条件を <code>id &lt; 1 || id &gt;= LONG_MAX</code>
  としています。 <code>LONG_MAX</code> を使っているのは
  <code>ParamID</code> が <code>unsigned long</code> の typedef
  だからです。</p>
  <p>コンテキストメニューが開かないときは <code>event.consumed</code>
  を変えずにリターンすることで、他のコントロールにマウスイベントが伝わるようにしています。</p>
  <h4 id="linux-で-vstgui-を利用"><a href="#linux-で-vstgui-を利用"
  class="header-anchor" aria-hidden="true">Linux で VSTGUI
  を利用</a></h4>
  <p><code>RunLoop</code> クラスを <code>VST3Editor</code>
  のコードからコピーして <code>x11runloop.hpp</code>
  というヘッダにします。</p>
  <div class="sourceCode" id="cb60"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma once</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if LINUX</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;base/source/fobject.h&quot;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui/lib/vstguibase.h&quot;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;pluginterfaces/gui/iplugview.h&quot;</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;vstgui/lib/platform/linux/x11frame.h&quot;</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> Steinberg <span class="op">{</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> Vst <span class="op">{</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> VSTGUI<span class="op">;</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Map Steinberg Vst Interface to VSTGUI Interface</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RunLoop <span class="op">:</span> <span class="kw">public</span> X11<span class="op">::</span>IRunLoop<span class="op">,</span> <span class="kw">public</span> AtomicReferenceCounted <span class="op">{</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">struct</span> EventHandler <span class="op">:</span> Steinberg<span class="op">::</span>Linux<span class="op">::</span>IEventHandler<span class="op">,</span> <span class="kw">public</span> Steinberg<span class="op">::</span>FObject <span class="op">{</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    X11<span class="op">::</span>IEventHandler <span class="op">*</span>handler<span class="op">{</span><span class="kw">nullptr</span><span class="op">};</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> PLUGIN_API onFDIsSet<span class="op">(</span>Steinberg<span class="op">::</span>Linux<span class="op">::</span>FileDescriptor<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>handler<span class="op">)</span> handler<span class="op">-&gt;</span>onEvent<span class="op">();</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    DELEGATE_REFCOUNT<span class="op">(</span>Steinberg<span class="op">::</span>FObject<span class="op">)</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    DEFINE_INTERFACES</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    DEF_INTERFACE<span class="op">(</span>Steinberg<span class="op">::</span>Linux<span class="op">::</span>IEventHandler<span class="op">)</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    END_DEFINE_INTERFACES<span class="op">(</span>Steinberg<span class="op">::</span>FObject<span class="op">)</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">struct</span> TimerHandler <span class="op">:</span> Steinberg<span class="op">::</span>Linux<span class="op">::</span>ITimerHandler<span class="op">,</span> <span class="kw">public</span> Steinberg<span class="op">::</span>FObject <span class="op">{</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>    X11<span class="op">::</span>ITimerHandler <span class="op">*</span>handler<span class="op">{</span><span class="kw">nullptr</span><span class="op">};</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> PLUGIN_API onTimer<span class="op">()</span> <span class="kw">final</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>handler<span class="op">)</span> handler<span class="op">-&gt;</span>onTimer<span class="op">();</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    DELEGATE_REFCOUNT<span class="op">(</span>Steinberg<span class="op">::</span>FObject<span class="op">)</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>    DEFINE_INTERFACES</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>    DEF_INTERFACE<span class="op">(</span>Steinberg<span class="op">::</span>Linux<span class="op">::</span>ITimerHandler<span class="op">)</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>    END_DEFINE_INTERFACES<span class="op">(</span>Steinberg<span class="op">::</span>FObject<span class="op">)</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> registerEventHandler<span class="op">(</span><span class="dt">int</span> fd<span class="op">,</span> X11<span class="op">::</span>IEventHandler <span class="op">*</span>handler<span class="op">)</span> <span class="kw">final</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>runLoop<span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> smtgHandler <span class="op">=</span> Steinberg<span class="op">::</span>owned<span class="op">(</span><span class="kw">new</span> EventHandler<span class="op">());</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>    smtgHandler<span class="op">-&gt;</span>handler <span class="op">=</span> handler<span class="op">;</span></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>runLoop<span class="op">-&gt;</span>registerEventHandler<span class="op">(</span>smtgHandler<span class="op">,</span> fd<span class="op">)</span> <span class="op">==</span> Steinberg<span class="op">::</span>kResultTrue<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>      eventHandlers<span class="op">.</span>push_back<span class="op">(</span>smtgHandler<span class="op">);</span></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> unregisterEventHandler<span class="op">(</span>X11<span class="op">::</span>IEventHandler <span class="op">*</span>handler<span class="op">)</span> <span class="kw">final</span></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>runLoop<span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> it <span class="op">=</span> eventHandlers<span class="op">.</span>begin<span class="op">(),</span> end <span class="op">=</span> eventHandlers<span class="op">.</span>end<span class="op">();</span> it <span class="op">!=</span> end<span class="op">;</span> <span class="op">++</span>it<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">((*</span>it<span class="op">)-&gt;</span>handler <span class="op">==</span> handler<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a>        runLoop<span class="op">-&gt;</span>unregisterEventHandler<span class="op">((*</span>it<span class="op">));</span></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a>        eventHandlers<span class="op">.</span>erase<span class="op">(</span>it<span class="op">);</span></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> registerTimer<span class="op">(</span><span class="dt">uint64_t</span> interval<span class="op">,</span> X11<span class="op">::</span>ITimerHandler <span class="op">*</span>handler<span class="op">)</span> <span class="kw">final</span></span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>runLoop<span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> smtgHandler <span class="op">=</span> Steinberg<span class="op">::</span>owned<span class="op">(</span><span class="kw">new</span> TimerHandler<span class="op">());</span></span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>    smtgHandler<span class="op">-&gt;</span>handler <span class="op">=</span> handler<span class="op">;</span></span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>runLoop<span class="op">-&gt;</span>registerTimer<span class="op">(</span>smtgHandler<span class="op">,</span> interval<span class="op">)</span> <span class="op">==</span> Steinberg<span class="op">::</span>kResultTrue<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a>      timerHandlers<span class="op">.</span>push_back<span class="op">(</span>smtgHandler<span class="op">);</span></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> unregisterTimer<span class="op">(</span>X11<span class="op">::</span>ITimerHandler <span class="op">*</span>handler<span class="op">)</span> <span class="kw">final</span></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>runLoop<span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> it <span class="op">=</span> timerHandlers<span class="op">.</span>begin<span class="op">(),</span> end <span class="op">=</span> timerHandlers<span class="op">.</span>end<span class="op">();</span> it <span class="op">!=</span> end<span class="op">;</span> <span class="op">++</span>it<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">((*</span>it<span class="op">)-&gt;</span>handler <span class="op">==</span> handler<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a>        runLoop<span class="op">-&gt;</span>unregisterTimer<span class="op">((*</span>it<span class="op">));</span></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a>        timerHandlers<span class="op">.</span>erase<span class="op">(</span>it<span class="op">);</span></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a>  RunLoop<span class="op">(</span>Steinberg<span class="op">::</span>FUnknown <span class="op">*</span>runLoop<span class="op">)</span> <span class="op">:</span> runLoop<span class="op">(</span>runLoop<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> EventHandlers <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>Steinberg<span class="op">::</span>IPtr<span class="op">&lt;</span>EventHandler<span class="op">&gt;&gt;;</span></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> TimerHandlers <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>Steinberg<span class="op">::</span>IPtr<span class="op">&lt;</span>TimerHandler<span class="op">&gt;&gt;;</span></span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a>  EventHandlers eventHandlers<span class="op">;</span></span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a>  TimerHandlers timerHandlers<span class="op">;</span></span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a>  Steinberg<span class="op">::</span>FUnknownPtr<span class="op">&lt;</span>Steinberg<span class="op">::</span>Linux<span class="op">::</span>IRunLoop<span class="op">&gt;</span> runLoop<span class="op">;</span></span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace Vst</span></span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="co">// namespace Steinberg</span></span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
  <p><code>PlugEditor</code> のコードに <code>x11runloop.hpp</code>
  をインクルードします。また CFrame の初期化が変わります。</p>
  <div class="sourceCode" id="cb61"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">//...</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;x11runloop.hpp&quot;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> PlugEditor<span class="op">::</span>open<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>parent<span class="op">,</span> <span class="at">const</span> PlatformType <span class="op">&amp;</span>platformType<span class="op">)</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>frame<span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  frame <span class="op">=</span> <span class="kw">new</span> CFrame<span class="op">(</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    CRect<span class="op">(</span>viewRect<span class="op">.</span>left<span class="op">,</span> viewRect<span class="op">.</span>top<span class="op">,</span> viewRect<span class="op">.</span>right<span class="op">,</span> viewRect<span class="op">.</span>bottom<span class="op">),</span> <span class="kw">this</span><span class="op">);</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>frame <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  frame<span class="op">-&gt;</span>setBackgroundColor<span class="op">(</span>CColor<span class="op">(</span><span class="bn">0xff</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0x00</span><span class="op">,</span> <span class="bn">0xff</span><span class="op">));</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  frame<span class="op">-&gt;</span>registerMouseObserver<span class="op">(</span><span class="kw">this</span><span class="op">);</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Linux で VSTGUI を使うには frame::open に platformType と config を渡す。</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  IPlatformFrameConfig <span class="op">*</span>config <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="pp">#if LINUX</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  X11<span class="op">::</span>FrameConfig x11config<span class="op">;</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  x11config<span class="op">.</span>runLoop <span class="op">=</span> VSTGUI<span class="op">::</span>owned<span class="op">(</span><span class="kw">new</span> RunLoop<span class="op">(</span>plugFrame<span class="op">));</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  config <span class="op">=</span> <span class="op">&amp;</span>x11config<span class="op">;</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>  frame<span class="op">-&gt;</span>open<span class="op">(</span>parent<span class="op">,</span> platformType<span class="op">,</span> config<span class="op">);</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <h4 id="コンテキストメニューにズーム機能を追加"><a
  href="#コンテキストメニューにズーム機能を追加" class="header-anchor"
  aria-hidden="true">コンテキストメニューにズーム機能を追加</a></h4>
  <p>この項の内容は実装をあきらめたので中途半端です。次の問題が解決されていないので注意してください。</p>
  <ul>
  <li>コンテキストメニューはコントロールの上でしか表示されない。</li>
  <li>入れ子になったメニューの登録がうまくできない。</li>
  <li>VSTGUI 4.11
  で導入された新しいイベントハンドラを使っていない。</li>
  </ul>
  <p>FL Studio 20.5
  でズーム後にプラグインのウィンドウがリサイズされなかったことが、あきらめた理由です。</p>
  <hr />
  <p>ズーム機能は GUI を任意の倍率で拡大する機能です。 VSTGUI4
  で高解像度ディスプレイへ対応するときに使えます。</p>
  <p>まずはエディタクラスに <code>CommandMenuItemTargetAdapter</code>
  を継承させて、ユーザがコンテキストメニューのアイテムを選択したときに通知されるようにします。</p>
  <div class="sourceCode" id="cb62"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PlugEditor <span class="op">:</span> <span class="kw">public</span> VSTGUIEditor<span class="op">,</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">public</span> IControlListener<span class="op">,</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">public</span> IMouseObserver<span class="op">,</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">public</span> CommandMenuItemTargetAdapter <span class="op">{</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// CommandMenuItemTargetAdapter の実装。</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> validateCommandMenuItem<span class="op">(</span>CCommandMenuItem <span class="op">*</span>item<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> onCommandMenuItemSelected<span class="op">(</span>CCommandMenuItem <span class="op">*</span>item<span class="op">)</span> <span class="kw">override</span><span class="op">;</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
  <p><code>onCommandMenuItemSelected</code> の実装です。 2
  つのメニューアイテムを用意して、 1.0 倍と 2.0
  倍を切り替えられるようにしています。倍率の切り替えには
  <code>CFrame</code> の <code>setZoom</code> を使います。</p>
  <div class="sourceCode" id="cb63"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> PlugEditor<span class="op">::</span>onCommandMenuItemSelected<span class="op">(</span>CCommandMenuItem <span class="op">*</span>item<span class="op">)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>item<span class="op">-&gt;</span>getCommandCategory<span class="op">()</span> <span class="op">!=</span> <span class="st">&quot;Scale&quot;</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>frame <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span> <span class="op">(</span>item<span class="op">-&gt;</span>getTag<span class="op">())</span> <span class="op">{</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>      frame<span class="op">-&gt;</span>setZoom<span class="op">(</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>      frame<span class="op">-&gt;</span>setZoom<span class="op">(</span><span class="fl">2.0</span><span class="op">);</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p><code>onMouseDown</code>
  を変更してマウスが右クリックされたときに表示されるコンテキストメニューにズームを行うアイテムを追加します。</p>
  <p>アイテムが選択されると <code>ContextMenuTarget</code> の
  <code>executeMenuItem</code> が呼び出されます。さらに
  <code>item-&gt;execute()</code> から
  <code>CommandMenuItemTargetAdapter</code> の
  <code>onCommandMenuItemSelected</code> が呼び出されます。</p>
  <div class="sourceCode" id="cb64"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ContextMenuTarget <span class="op">:</span> <span class="kw">public</span> IContextMenuTarget<span class="op">,</span> <span class="kw">public</span> FObject <span class="op">{</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  ContextMenuTarget<span class="op">(</span>CCommandMenuItem <span class="op">*</span>item<span class="op">)</span> <span class="op">:</span> item<span class="op">(</span>item<span class="op">)</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    item<span class="op">-&gt;</span>remember<span class="op">();</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">~</span>ContextMenuTarget<span class="op">()</span> <span class="kw">override</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    item<span class="op">-&gt;</span>forget<span class="op">();</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  Steinberg<span class="op">::</span>tresult PLUGIN_API executeMenuItem<span class="op">(</span>Steinberg<span class="op">::</span>int32 tag<span class="op">)</span> <span class="kw">override</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    item<span class="op">-&gt;</span>execute<span class="op">();</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Steinberg<span class="op">::</span>kResultTrue<span class="op">;</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  OBJ_METHODS<span class="op">(</span>ContextMenuTarget<span class="op">,</span> Steinberg<span class="op">::</span>FObject<span class="op">)</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  FUNKNOWN_METHODS<span class="op">(</span>Steinberg<span class="op">::</span>Vst<span class="op">::</span>IContextMenuTarget<span class="op">,</span> Steinberg<span class="op">::</span>FObject<span class="op">)</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  CCommandMenuItem <span class="op">*</span>item<span class="op">;</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>CMouseEventResult</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>PlugEditor<span class="op">::</span>onMouseDown<span class="op">(</span>CFrame <span class="op">*</span>frame<span class="op">,</span> <span class="at">const</span> CPoint <span class="op">&amp;</span>where<span class="op">,</span> <span class="at">const</span> CButtonState <span class="op">&amp;</span>buttons<span class="op">)</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span>buttons<span class="op">.</span>isRightButton<span class="op">())</span> <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> componentHandler <span class="op">=</span> controller<span class="op">-&gt;</span>getComponentHandler<span class="op">();</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>componentHandler <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  FUnknownPtr<span class="op">&lt;</span>IComponentHandler3<span class="op">&gt;</span> handler<span class="op">(</span>componentHandler<span class="op">);</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>handler <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> control <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>CControl <span class="op">*&gt;(</span>frame<span class="op">-&gt;</span>getViewAt<span class="op">(</span>where<span class="op">));</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>control <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  ParamID id <span class="op">=</span> control<span class="op">-&gt;</span>getTag<span class="op">();</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>id <span class="op">&lt;</span> <span class="dv">1</span> <span class="op">||</span> id <span class="op">&gt;=</span> LONG_MAX<span class="op">)</span> <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> contextMenu <span class="op">=</span> handler<span class="op">-&gt;</span>createContextMenu<span class="op">(</span><span class="kw">this</span><span class="op">,</span> <span class="op">&amp;</span>id<span class="op">);</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>contextMenu <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span> <span class="cf">return</span> kMouseEventNotHandled<span class="op">;</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ここからメニューの追加。</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">// kIsGroupStart を設定してもメニューが入れ子にならない。</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>  IContextMenu<span class="op">::</span>Item groupItem<span class="op">{};</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>  UString128<span class="op">(</span><span class="st">&quot;Scale&quot;</span><span class="op">).</span>copyTo<span class="op">(</span>groupItem<span class="op">.</span>name<span class="op">,</span> <span class="dv">128</span><span class="op">);</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>  groupItem<span class="op">.</span>flags <span class="op">=</span> IContextMenu<span class="op">::</span>Item<span class="op">::</span>kIsGroupStart<span class="op">;</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>  contextMenu<span class="op">-&gt;</span>addItem<span class="op">(</span>groupItem<span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>array<span class="op">&lt;</span><span class="dt">double</span><span class="op">,</span> <span class="dv">2</span><span class="op">&gt;</span> scales <span class="op">=</span> <span class="op">{</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">2.0</span><span class="op">};</span></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> scales<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>index<span class="op">)</span> <span class="op">{</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>    IContextMenu<span class="op">::</span>Item item<span class="op">{};</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>    UString128<span class="op">(</span><span class="bu">std::</span>to_string<span class="op">(</span>scales<span class="op">[</span>index<span class="op">]).</span>c_str<span class="op">()).</span>copyTo<span class="op">(</span>item<span class="op">.</span>name<span class="op">,</span> <span class="dv">128</span><span class="op">);</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>flags <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>tag <span class="op">=</span> <span class="op">(</span><span class="dt">int32_t</span><span class="op">)</span>index<span class="op">;</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 注意: VSTGUI 4.8 では CCommandMenuItem::Desc に渡した tag が</span></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// CCommandMenuItem に渡されずに無視される。</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> command <span class="op">=</span> <span class="kw">new</span> CCommandMenuItem<span class="op">({</span><span class="kw">nullptr</span><span class="op">,</span> item<span class="op">.</span>tag<span class="op">,</span> <span class="kw">this</span><span class="op">,</span> <span class="st">&quot;Scale&quot;</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">});</span></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>    command<span class="op">-&gt;</span>setTag<span class="op">(</span>item<span class="op">.</span>tag<span class="op">);</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>    contextMenu<span class="op">-&gt;</span>addItem<span class="op">(</span>item<span class="op">,</span> <span class="kw">new</span> ContextMenuTarget<span class="op">(</span>command<span class="op">));</span></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">// kIsGroupEnd を設定してもメニューが入れ子にならない。</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>  groupItem<span class="op">.</span>flags <span class="op">=</span> IContextMenu<span class="op">::</span>Item<span class="op">::</span>kIsGroupEnd<span class="op">;</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>  contextMenu<span class="op">-&gt;</span>addItem<span class="op">(</span>groupItem<span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ここまでメニューの追加。</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>  contextMenu<span class="op">-&gt;</span>popup<span class="op">(</span>where<span class="op">.</span>x<span class="op">,</span> where<span class="op">.</span>y<span class="op">);</span></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>  contextMenu<span class="op">-&gt;</span>release<span class="op">();</span></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> kMouseEventHandled<span class="op">;</span></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
  <p>コメントにも書いていますが、 <code>kIsGroupStart</code> と
  <code>kIsGroupEnd</code>
  を設定してもメニューが入れ子になりません。</p>
  <p>どこを右クリックしてもメニューが開くようにするには
  <code>COptionMenu</code>
  でメニューを作っておいて、コントロール上で右クリックされているときは
  <code>IContextMenu</code> に変換する、そうでなければ
  <code>COptionMenu</code>
  をそのままポップアップする、という処理が考えられます。
  <code>vstgui4/vstgui/plugin-bindings/vst3editor.*</code>
  に実装例があります。</p>

  <footer>
        <p><a href="../index.html">Back to Index</a></p>
      </footer>
  </body>

</html>
